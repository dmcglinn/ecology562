<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Final Part 2&mdash;Solution</title>
<link rel="stylesheet" type="text/css" href="https://sakai.unc.edu/access/content/group/2842013b-58f5-4453-aa8d-3e01bacbfc3d/public/Ecol562_Spring2012/docs/solutions/css/green.css" title="green" /> 
<link rel="stylesheet" type="text/css" href="https://sakai.unc.edu/access/content/group/2842013b-58f5-4453-aa8d-3e01bacbfc3d/public/Ecol562_Spring2012/docs/solutions/css/calendar.css" title="calendar" /> 
<link rel="alternate stylesheet" type="text/css" media="all" href="https://sakai.unc.edu/access/content/group/2842013b-58f5-4453-aa8d-3e01bacbfc3d/public/Ecol562_Spring2012/docs/solutions/css/purple.css" title="purple" /> 
<link rel="alternate stylesheet" type="text/css" media="all" href="https://sakai.unc.edu/access/content/group/2842013b-58f5-4453-aa8d-3e01bacbfc3d/public/Ecol562_Spring2012/docs/solutions/css/large.css" title="large" /> 
<link rel="alternate stylesheet" type="text/css" media="all" href="https://sakai.unc.edu/access/content/group/2842013b-58f5-4453-aa8d-3e01bacbfc3d/public/Ecol562_Spring2012/docs/solutions/css/reverse.css" title="reverse" /> 
<!-- the @import method only works from 5.0 and upwards  -->
<!-- so, using @import would "hide" the more sophisticated sheet from < 5.0 browsers -->
<!-- <style type="text/css" media="all">@import "fancy_style.css";</style> -->
<script language="JavaScript" type="text/javascript" src="https://sakai.unc.edu/access/content/group/2842013b-58f5-4453-aa8d-3e01bacbfc3d/public/Ecol562_Spring2012/docs/solutions/js/styleswitcher.js"></script> 
<style type="text/css">
<!--
div.figure {float:none;width=25%;} 
div.figure p {test-align: center;font-style:italic;}
div.figureL {float:left;width=50%; margin:1.5em;padding:4px 4px 4px 0px;} 
div.figureL p {test-align: center;font-style:italic;}
div.figureR {float:right;width=50%;margin:1.5em;padding:4px 4px 4px 0px;} 
div.figureR p {test-align: center;font-style:italic;}
.style1 {font-family: "Courier New", Courier, mono}
.style2 {
	color: #0000FF;
	font-family: "Courier New", Courier, mono;
	font-size: smaller;
}
.style7 {font-family: "Courier New", Courier, mono; color: #00CC00; }

.style8 {
	font-family: Arial, Helvetica, sans-serif;
	color: #810000;
}
.style11 {font-family: "Courier New", Courier, mono;}
.style22 {color: #663366; font-weight: bold; }
.style10 {
	font-family: "Courier New", Courier, mono;
	color: #000000;
	background-color:#F0F0F0;
}
.style33 {
	font-family: "Courier New", Courier, mono;
	color: #000000;
	background-color:#FFFACD;
}
.style15 {font-family: "Courier New", Courier, mono; color: #339933; font-weight: bold; background-color:#F0F0F0; }

.style34 {font-family: "Courier New", Courier, mono; color: #339933; font-weight: bold; background-color:#FFFACD; }
.style43 {color: #0000FF; font-weight: bold; font-family: "Courier New", Courier, mono;  background-color:#FFFACD;}

.style19 {color: #339933;
	font-weight: bold;}

.style24 {
	font-family: "Courier New", Courier, mono;
	color: #0000FF;
	font-size:small;
}

.style42 {color: #0000FF; font-weight: bold; font-family: "Courier New", Courier, mono;  background-color:#F0F0F0;}



a:link {color: #0000CC; text-decoration:none}
a:visited {color: #0000CC; text-decoration:none}
a:hover {color: green; text-decoration:underline; background:#F9EDED}
a:active {color: red; text-decoration:none}
.style16 {font-size: larger}
.style18 {color: #009966; font-weight: bold; font-family: "Courier New", Courier, mono; font-size: smaller; }
.style6 {color: #CC0033}
.style4 {	color: #CC0000;
	font-weight: bold;
}
.style25 {
	font-family: "Courier New", Courier, mono;
	color: #0000FF;
	background-color:#FFFC9A;
	font-size:small;
}

.styleArial {
	font-family: Arial, Helvetica, sans-serif;font-size:11.0pt;
}
.style12 {color: #008000}
.style151 {	color: #990099;
	font-weight: bold;
}
.style161 {	color: #CC0000;
	font-weight: bold;
}
.style181 {color: #008000; font-weight: bold; }
.style241 {	font-family: "Courier New", Courier, mono;
	color: #0000FF;
	font-size:smaller;
}
.style9 {	font-size:small;
}
-->
</style>
</head>


<body>
<h1 align="center"><a name="finalpart2" id="assign6"></a>Final Part 2&mdash;Solution</h1>
<div class="style10" style="padding-left: 30px; text-indent:-30px">elfin &lt;- read.csv( 'ecol 562/elfin.csv')</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> names(elfin)</div>
<span class="style24"> [1] &quot;Occupied_Unoccupied&quot; &quot;TotalCanopy&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;WildIndigoSize&quot;&nbsp;&nbsp;&nbsp;&nbsp; <br>
[4] &quot;NearestWildIndigo&quot;&nbsp;&nbsp; &quot;DistanceNearestTree&quot; &quot;DirectionTree&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
[7] &quot;Slope&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;SlopeAspect&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> dim(elfin)</div>
<span class="style24"> [1] 454&nbsp;&nbsp; 8</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> apply(elfin, 2, function(x) sum(is.na(x)))</div>
<span class="style24"> Occupied_Unoccupied&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WildIndigoSize <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;0 <br>
&nbsp; NearestWildIndigo DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DirectionTree <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Slope&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SlopeAspect <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;126</span>
<p>We see that the <span class="style1">SlopeAspect</span> variable has a lot of missing data.</p>
<h2>Question 1</h2>
<p>In order to fit a classification tree we have to convert the response variable, <span class="style8">Occupied_Unoccupied</span>, into a factor.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">library(rpart)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> set.seed(20)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> out2 &lt;- rpart(factor(Occupied_Unoccupied)~., data=elfin, control=rpart.control(cp=.00001))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> out2</div>
<span class="style24">n= 454 </span>
<p><span class="style24">node), split, n, loss, yval, (yprob)<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * denotes terminal node</span>
<p><span class="style24">&nbsp;1) root 454 207 0 (0.5440529 0.4559471)&nbsp; <br>
  &nbsp;&nbsp; 2) TotalCanopy&lt; 8.2 210&nbsp; 40 0 (0.8095238 0.1904762)&nbsp; <br>
  &nbsp;&nbsp;&nbsp;&nbsp; 4) WildIndigoSize&lt; 58.88 127&nbsp;&nbsp; 9 0 (0.9291339 0.0708661) *<br>
  &nbsp;&nbsp;&nbsp;&nbsp; 5) WildIndigoSize&gt;=58.88 83&nbsp; 31 0 (0.6265060 0.3734940)&nbsp; <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10) DistanceNearestTree&gt;=595 46&nbsp;&nbsp; 5 0 (0.8913043 0.1086957) *<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11) DistanceNearestTree&lt; 595 37&nbsp; 11 1 (0.2972973 0.7027027)&nbsp; <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 22) DirectionTree&gt;=247.5 9&nbsp;&nbsp; 4 0 (0.5555556 0.4444444) *<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 23) DirectionTree&lt; 247.5 28&nbsp;&nbsp; 6 1 (0.2142857 0.7857143) *<br>
  &nbsp;&nbsp; 3) TotalCanopy&gt;=8.2 244&nbsp; 77 1 (0.3155738 0.6844262)&nbsp; <br>
  &nbsp;&nbsp;&nbsp;&nbsp; 6) WildIndigoSize&lt; 58.155 116&nbsp; 49 0 (0.5775862 0.4224138)&nbsp; <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12) TotalCanopy&gt;=65.235 33&nbsp;&nbsp; 2 0 (0.9393939 0.0606061) *<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 13) TotalCanopy&lt; 65.235 83&nbsp; 36 1 (0.4337349 0.5662651)&nbsp; <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 26) TotalCanopy&lt; 18.88 30&nbsp;&nbsp; 5 0 (0.8333333 0.1666667) *<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 27) TotalCanopy&gt;=18.88 53&nbsp; 11 1 (0.2075472 0.7924528) *<br>
  &nbsp;&nbsp;&nbsp;&nbsp; 7) WildIndigoSize&gt;=58.155 128&nbsp; 10 1 (0.0781250 0.9218750) * </span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> plotcp(out2)</div>
<br>
<table width="400" border="0" align="center">
  <tr>
    <th scope="col"><img src="../../images/assignments/finalpart2/fig1.png" width="345" height="305" alt="fig 1"></th>
  </tr>
  <tr>
    <td class="styleArial"><strong>Fig. 1</strong>&nbsp;&nbsp;Plot of cross-validation error versus Cp</td>
  </tr>
</table>
<br>
<div class="style10" style="padding-left: 30px; text-indent:-30px">out2$cptable</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CP nsplit rel error&nbsp;&nbsp; xerror&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xstd<br>
1 0.43478261&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 1.000000 1.000000 0.0512667<br>
2 0.08695652&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0.565217 0.579710 0.0453906<br>
3 0.07487923&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; 0.478261 0.541063 0.0443735<br>
4 0.03623188&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp; 0.328502 0.444444 0.0413761<br>
5 0.00483092&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6&nbsp; 0.256039 0.323671 0.0365086<br>
6 0.00001000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7&nbsp; 0.251208 0.352657 0.0378117</span>
<p>The plot is unambiguous. The first tree whose cross-validation error is within one standard deviation of the minimum cross-validation error is the tree with minimum cross-validation error. We should select a tree of size 7 (nsplit = 6) corresponding to Cp = 0.0048. </p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> which.min(out2$cptable[,&quot;xstd&quot;])</div>
<span class="style24"> 5 <br>
5 </span>
<div class="style10" style="padding-left: 30px; text-indent:-30px">out2a &lt;- prune(out2, cp=out2$cptable[5,&quot;CP&quot;])</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> plot(out2a, margin=0.075)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">text(out2a, cex=0.8, use.n=T)</div>
<br>
<table width="400" border="0" align="center">
  <tr>
    <th scope="col"><img src="../../images/assignments/finalpart2/fig2.png" width="345" height="265" alt="fig2"></th>
  </tr>
  <tr>
    <td class="styleArial"><strong>Fig. 2</strong>&nbsp;&nbsp;Pruned classification tree</td>
  </tr>
</table>
<h2>Question 2</h2>
<p> I fit a GAM using all the predictors and then try to simplify it. We can't specify more knots than there are unique values (the default choice is k = 10), so I determine the number of unique values for each variable.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> apply(elfin,2, function(x) sum(!is.na(unique(x))))</div>
 <span class="style24"> Occupied_Unoccupied&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WildIndigoSize&nbsp;&nbsp; NearestWildIndigo <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 184&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 402&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 114 <br>
  DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;Slope&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SlopeAspect <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 212&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8</span>
<p>We need to use no more than 8 knots for <span class="style8">DirectionTree</span> and <span class="style8">SlopeAspect</span>.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">library(mgcv)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">  gam1 &lt;- gam(Occupied_Unoccupied~s(TotalCanopy)+ s(WildIndigoSize)+ s(NearestWildIndigo)+ s(DistanceNearestTree)+ 
  s(DirectionTree,k=8)+ s(Slope)+ s(SlopeAspect,k=8), data=elfin, method=&quot;ML&quot;, family=binomial)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">summary(gam1)</div>
<span class="style24">Family: binomial <br>
  Link function: logit </span>
<p><span class="style24">Formula:<br>
  Occupied_Unoccupied ~ s(TotalCanopy) + s(WildIndigoSize) + s(NearestWildIndigo) + <br>
  &nbsp;&nbsp;&nbsp; s(DistanceNearestTree) + s(DirectionTree, k = 8) + s(Slope) + <br>
  &nbsp;&nbsp;&nbsp; s(SlopeAspect, k = 8)</span>
<p><span class="style24">Parametric coefficients:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)&nbsp; <br>
  (Intercept)&nbsp; -0.6010&nbsp;&nbsp;&nbsp;&nbsp; 0.3566&nbsp; -1.685&nbsp;&nbsp; 0.0919 .<br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<p><span class="style24">Approximate significance of smooth terms:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; edf Ref.df Chi.sq&nbsp; p-value&nbsp;&nbsp;&nbsp; <br>
  s(TotalCanopy)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.409&nbsp; 4.249 31.697 2.96e-06 ***<br>
  s(WildIndigoSize)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000&nbsp; 1.000 32.884 9.79e-09 ***<br>
  s(NearestWildIndigo)&nbsp;&nbsp; 1.000&nbsp; 1.000&nbsp; 9.586&nbsp; 0.00196 ** <br>
  s(DistanceNearestTree) 2.091&nbsp; 2.629&nbsp; 4.592&nbsp; 0.16224&nbsp;&nbsp;&nbsp; <br>
  s(DirectionTree)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000&nbsp; 1.000&nbsp; 3.928&nbsp; 0.04749 *&nbsp; <br>
  s(Slope)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000&nbsp; 1.000&nbsp; 0.054&nbsp; </span><span class="style25">0.81608</span><span class="style24">&nbsp;&nbsp;&nbsp; <br>
  s(SlopeAspect)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000&nbsp; 1.000&nbsp; 0.667&nbsp; </span><span class="style25">0.41416</span><span class="style24">&nbsp;&nbsp;&nbsp; <br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<p><span class="style24">R-sq.(adj) =&nbsp;&nbsp; 0.58&nbsp;&nbsp; Deviance explained = 53.1%<br>
  ML score = 116.83&nbsp; Scale est. = 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n = 328</span>
<p>The summary table suggests that <span class="style8">Slope</span> and <span class="style8">SlopeAspect</span> are not significant, but we know that the <em>p</em>-values of the Wald tests for GAMs can be quite unreliable. The different reduced models we might fit and compare against this one are not all equivalent because the variable<span class="style8"> SlopeAspect</span> has a large number of missing values. </p>
<div class="style15" style="padding-left: 30px; text-indent:-30px"> #check for missing values</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> apply(elfin,2,function(x) sum(is.na(x)))</div>
<span class="style24"> Occupied_Unoccupied&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WildIndigoSize&nbsp;&nbsp; NearestWildIndigo <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 <br>
  DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Slope&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SlopeAspect <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 126</span>
<p>The <span class="style161">gam</span> function will silently remove these missing values anytime <span class="style8">SlopeAspect</span> is a predictor in the model. Models that are fit to different sets of observations cannot be compared using significance testing or AIC. 
It makes sense to test <span class="style8">SlopeAspect</span> first because if it can be dropped then the remaining variables can be examined using the full data set. To make  models with and without <span class="style8">SlopeAspect</span> comparable I need to explicitly remove the observations that have missing values for <span class="style8">SlopeAspect</span>  before fitting the model without <span class="style8">SlopeAspect</span>.</p>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#remove observations with missing values of SlopeAspect</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> elfin2 &lt;- elfin[!is.na(elfin$SlopeAspect),]</div>
 
<p>As was explained in <a href="../lectures/lecture39.htm">lecture 39</a>, the default number of knots (10) is set too low for a number of these smooths and has the effect of constraining then. As a result, when <span class="style8">SlopeAspect</span> is removed from the model it partially releases this constraint causing the two models to use different smoothing parameters. These models are then not truly nested and the likelihood ratio test is invalid. We can fix this by increasing the number of knots and/or using the smoothing parameters from the bigger model in the smaller model.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> gam1 &lt;- gam(Occupied_Unoccupied~s(TotalCanopy,k=20) + s(WildIndigoSize,k=20) + s(NearestWildIndigo,k=20) +s(DistanceNearestTree,k=20)+ s(DirectionTree,k=8)+ s(Slope)+ s(SlopeAspect,k=8), data=elfin2, method=&quot;ML&quot;, family=binomial)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> gam2 &lt;- gam(Occupied_Unoccupied~s(TotalCanopy,k=20) + s(WildIndigoSize,k=20) + s(NearestWildIndigo,k=20)+
s(DistanceNearestTree,k=20) + s(DirectionTree,k=8)+ s(Slope), data=elfin2, method=&quot;ML&quot;, family=binomial, sp=gam1$sp[1:6])</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> anova(gam2, gam1)</div>
<span class="style24">Analysis of Deviance Table</span>
<p><span class="style24">Model 1: Occupied_Unoccupied ~ s(TotalCanopy, k = 20) + s(WildIndigoSize, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(NearestWildIndigo, k = 20) + s(DistanceNearestTree, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(DirectionTree, k = 8) + s(Slope)<br>
  Model 2: Occupied_Unoccupied ~ s(TotalCanopy, k = 20) + s(WildIndigoSize, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(NearestWildIndigo, k = 20) + s(DistanceNearestTree, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(DirectionTree, k = 8) + s(Slope) + s(SlopeAspect, <br>
  &nbsp;&nbsp;&nbsp; k = 8)<br>
  &nbsp; Resid. Df Resid. Dev&nbsp;&nbsp;&nbsp;&nbsp; Df Deviance<br>
  1&nbsp;&nbsp;&nbsp; 317.41&nbsp;&nbsp;&nbsp;&nbsp; 213.32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
  2&nbsp;&nbsp;&nbsp; 316.42&nbsp;&nbsp;&nbsp;&nbsp; 212.53 0.9898&nbsp; </span><span class="style25">0.79907</span>
<p>We can drop <span class="style8">SlopeAspect</span>. With that taken care of I refit the model to the full data set.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> gam2 &lt;- gam(Occupied_Unoccupied~s(TotalCanopy,k=20) + s(WildIndigoSize,k=20) + s(NearestWildIndigo,k=20)+ s(DistanceNearestTree,k=20) + s(DirectionTree,k=8)+ s(Slope), data=elfin, method=&quot;ML&quot;, family=binomial)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> summary(gam2)</div>
<p><span class="style24">Family: binomial <br>
  Link function: logit </span>
<p><span class="style24">Formula:<br>
  Occupied_Unoccupied ~ s(TotalCanopy, k = 20) + s(WildIndigoSize, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(NearestWildIndigo, k = 20) + s(DistanceNearestTree, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(DirectionTree, k = 8) + s(Slope)</span>
<p><span class="style24">Parametric coefficients:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)&nbsp;&nbsp; <br>
  (Intercept)&nbsp; -0.7841&nbsp;&nbsp;&nbsp;&nbsp; 0.2947&nbsp;&nbsp; -2.66&nbsp;&nbsp; 0.0078 **<br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<p><span class="style24">Approximate significance of smooth terms:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; edf Ref.df Chi.sq&nbsp; p-value&nbsp;&nbsp;&nbsp; <br>
  s(TotalCanopy)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.514&nbsp; 4.408 37.816 2.04e-07 ***<br>
  s(WildIndigoSize)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.532&nbsp; 3.172 52.407 3.24e-11 ***<br>
  s(NearestWildIndigo)&nbsp;&nbsp; 1.000&nbsp; 1.000 13.037 0.000305 ***<br>
  s(DistanceNearestTree) 3.281&nbsp; 4.091&nbsp; 8.895 0.067595 .&nbsp; <br>
  s(DirectionTree)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000&nbsp; 1.000&nbsp; 4.152 0.041576 *&nbsp; <br>
  s(Slope)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000&nbsp; 1.000&nbsp; 0.179 </span><span class="style25">0.672329</span><span class="style24">&nbsp;&nbsp;&nbsp; <br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<p><span class="style24">R-sq.(adj) =&nbsp; 0.587&nbsp;&nbsp; Deviance explained = 53.1%<br>
  ML score = 164.05&nbsp; Scale est. = 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n = 454</span>

<p><span class="style8">Slope</span> is the next candidate to be dropped. I use the same smoothing parameters</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> gam3 &lt;- gam(Occupied_Unoccupied~s(TotalCanopy,k=20) + s(WildIndigoSize,k=20) + s(NearestWildIndigo,k=20)+ s(DistanceNearestTree,k=20) + s(DirectionTree,k=8), data=elfin, method=&quot;ML&quot;, family=binomial, sp=gam2$sp[1:5])</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> anova(gam3, gam2, test='Chisq')</div>
<span class="style24">Analysis of Deviance Table</span>
<p><span class="style24">Model 1: Occupied_Unoccupied ~ s(TotalCanopy, k = 20) + s(WildIndigoSize, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(NearestWildIndigo, k = 20) + s(DistanceNearestTree, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(DirectionTree, k = 8)<br>
  Model 2: Occupied_Unoccupied ~ s(TotalCanopy, k = 20) + s(WildIndigoSize, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(NearestWildIndigo, k = 20) + s(DistanceNearestTree, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(DirectionTree, k = 8) + s(Slope)<br>
  &nbsp; Resid. Df Resid. Dev&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Df Deviance Pr(&gt;Chi)<br>
  1&nbsp;&nbsp;&nbsp; 441.66&nbsp;&nbsp;&nbsp;&nbsp; 293.59&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
  2&nbsp;&nbsp;&nbsp; 440.67&nbsp;&nbsp;&nbsp;&nbsp; 293.43 0.98928&nbsp; 0.15979&nbsp;&nbsp;&nbsp; </span><span class="style25">0.685
  </span>
<p><span class="style8">Slope</span> can be dropped. I refit the model using its own smoothing parameters.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">gam3 &lt;- gam(Occupied_Unoccupied~s(TotalCanopy,k=20) + s(WildIndigoSize,k=20) + s(NearestWildIndigo,k=20)+ s(DistanceNearestTree,k=20) + s(DirectionTree,k=8), data=elfin, method=&quot;ML&quot;, family=binomial)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> summary(gam3)</div>
<span class="style24">Family: binomial <br>
  Link function: logit </span>
<p><span class="style24">Formula:<br>
  Occupied_Unoccupied ~ s(TotalCanopy, k = 20) + s(WildIndigoSize, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(NearestWildIndigo, k = 20) + s(DistanceNearestTree, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(DirectionTree, k = 8)</span>
<p><span class="style24">Parametric coefficients:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)&nbsp;&nbsp; <br>
  (Intercept)&nbsp; -0.7793&nbsp;&nbsp;&nbsp;&nbsp; 0.2893&nbsp; -2.694&nbsp; 0.00707 **<br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<p><span class="style24">Approximate significance of smooth terms:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; edf Ref.df Chi.sq&nbsp; p-value&nbsp;&nbsp;&nbsp; <br>
  s(TotalCanopy)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.527&nbsp; 4.420 37.900 1.99e-07 ***<br>
  s(WildIndigoSize)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.629&nbsp; 3.294 52.377 3.99e-11 ***<br>
  s(NearestWildIndigo)&nbsp;&nbsp; 1.000&nbsp; 1.000 13.167 0.000285 ***<br>
  s(DistanceNearestTree) 3.238&nbsp; 4.036&nbsp; 8.795 </span><span class="style25">0.067999</span><span class="style24"> .&nbsp; <br>
  s(DirectionTree)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.000&nbsp; 1.000&nbsp; 4.132 0.042079 *&nbsp; <br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<p><span class="style24">R-sq.(adj) =&nbsp; 0.588&nbsp;&nbsp; Deviance explained = 53.1%<br>
  ML score = 164.14&nbsp; Scale est. = 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n = 454</span>

<p><span class="style8">DistanceNearestTree</span> is the next candidate to be dropped. I consider a likelihood ratio test.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> gam3a &lt;- gam(Occupied_Unoccupied~s(TotalCanopy,k=20) + s(WildIndigoSize,k=20) + s(NearestWildIndigo,k=20)+&nbsp; s(DirectionTree,k=8), data=elfin, method=&quot;ML&quot;, family=binomial)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> anova(gam3a, gam3, test='Chisq')</div>
<span class="style24">Analysis of Deviance Table</span>
<p><span class="style24">Model 1: Occupied_Unoccupied ~ s(TotalCanopy, k = 20) + s(WildIndigoSize, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(NearestWildIndigo, k = 20) + s(DirectionTree, <br>
  &nbsp;&nbsp;&nbsp; k = 8)<br>
  Model 2: Occupied_Unoccupied ~ s(TotalCanopy, k = 20) + s(WildIndigoSize, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(NearestWildIndigo, k = 20) + s(DistanceNearestTree, <br>
  &nbsp;&nbsp;&nbsp; k = 20) + s(DirectionTree, k = 8)<br>
  &nbsp; Resid. Df Resid. Dev&nbsp;&nbsp;&nbsp;&nbsp; Df Deviance&nbsp; Pr(&gt;Chi)&nbsp;&nbsp;&nbsp; <br>
  1&nbsp;&nbsp;&nbsp; 443.64&nbsp;&nbsp;&nbsp;&nbsp; 315.02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
  2&nbsp;&nbsp;&nbsp; 441.61&nbsp;&nbsp;&nbsp;&nbsp; 293.41 2.0304&nbsp;&nbsp; 21.607 </span><span class="style25">2.129e-05</span><span class="style24"> ***<br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>

<p>The likelihood ratio test and Wald test are in strong disagreement. The likelihood ratio test argues we should retain <span class="style8">DistanceNearestTree</span>. So our final model has the smooths of five predictors of which three appear to be nonlinear (based on the reported edf) and two are linear.</p>
<h2>Question 3</h2>
<p>My basic strategy is to fit a logistic regression model using all of the variables and then gradually weed out those predictors that are flawed and/or have no relationship to the responses. I  use the tree results as well as a GAM to suggest interactions and improve the structural forms for the various remaining predictors. I start the process by including all the variables individually and additively in a logistic regression model</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">mod1 &lt;- glm(Occupied_Unoccupied~., data=elfin, family=binomial)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">round(summary(mod1)$coefficients,4)</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)<br>
(Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0255&nbsp;&nbsp;&nbsp;&nbsp; 0.5314 -0.0481&nbsp;&nbsp; 0.9617<br>
TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0025&nbsp;&nbsp;&nbsp;&nbsp; 0.0075 -0.3344&nbsp;&nbsp; 0.7381<br>
WildIndigoSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0285&nbsp;&nbsp;&nbsp;&nbsp; 0.0045&nbsp; 6.2689&nbsp;&nbsp; 0.0000<br>
NearestWildIndigo&nbsp;&nbsp;&nbsp; -0.0096&nbsp;&nbsp;&nbsp;&nbsp; 0.0031 -3.1454&nbsp;&nbsp; 0.0017<br>
DistanceNearestTree&nbsp; -0.0047&nbsp;&nbsp;&nbsp;&nbsp; 0.0008 -5.6250&nbsp;&nbsp; 0.0000<br>
DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0027&nbsp;&nbsp;&nbsp;&nbsp; 0.0015 -1.8231&nbsp;&nbsp; 0.0683<br>
Slope&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0054&nbsp;&nbsp;&nbsp;&nbsp; 0.0529 -0.1024&nbsp;&nbsp; 0.9184<br>
SlopeAspect&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0001&nbsp;&nbsp;&nbsp;&nbsp; 0.0020&nbsp; 0.0651&nbsp;&nbsp; 0.9481</span>
<p><strong>Dealing with the angle variables</strong></p>
<p>The variable <span class="style8">SlopeAspect</span> is an obvious candidate for omission. Recall that <span class="style8">SlopeAspect</span> is a variable with a lot of missing values. Both <span class="style8">Slope</span> and <span class="style8">SlopeAspect</span> are angles and angles require some care when including them in regression models. I examine their values.<br>
</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> unique(elfin$Slope)</div>
<span class="style24"> &nbsp;[1]&nbsp; 1&nbsp; 0&nbsp; 2&nbsp; 3&nbsp; 6&nbsp; 8&nbsp; 7&nbsp; 9 10&nbsp; 4&nbsp; 5 14 13 11 12</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> unique(elfin$SlopeAspect)</div>
<span class="style24">[1]&nbsp; 45&nbsp; NA&nbsp; 90 135 315 270 225&nbsp;&nbsp; 0 180</span>
<p>The values for <span class="style8">Slope</span> are all rather close so nothing more needs to be done with it, but <span class="style8">SlopeAspect</span> has a wide range. Angles are circular measures and consequently 0 and 360 are the same angle. This means on a circular scale that 315 is as close to 0 as 45 is to 0. Currently in the regression model 0 and 315 are  treated as being the the furthest apart. How angle should be included in a regression model depends on how we think angle impacts the response. This is a substantive issue not a statistical one. Having said that it is almost certainly the case given the range of the data that using the raw angle measured in degrees makes very little sense. One possibility is to use the cosine or sine of the angles. I try each in turn and both together.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod1a &lt;- update(mod1, .~. - SlopeAspect + cos(SlopeAspect/360*2*pi))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">mod1b &lt;- update(mod1, .~. - SlopeAspect + sin(SlopeAspect/360*2*pi))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">mod1c &lt;- update(mod1, .~. - SlopeAspect + cos(SlopeAspect/360*2*pi) + sin(SlopeAspect/360*2*pi))</div>

<div class="style10" style="padding-left: 30px; text-indent:-30px"> AIC(mod1, mod1a, mod1b, mod1c)</div>
 <span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AIC<br>
  mod1&nbsp;&nbsp; 8 278.9459<br>
  mod1a&nbsp; 8 277.5965<br>
  mod1b&nbsp; 8 278.8972<br>
  mod1c&nbsp; 9 279.4565</span>
<p>The model with lowest AIC uses  cosine. If we examine the summary table we find that its coefficient is not significant. So, we can drop it.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> round(summary(mod1a)$coefficients,4)</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)<br>
(Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0708&nbsp;&nbsp;&nbsp;&nbsp; 0.4887&nbsp; 0.1448&nbsp;&nbsp; 0.8849<br>
TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0018&nbsp;&nbsp;&nbsp;&nbsp; 0.0076 -0.2378&nbsp;&nbsp; 0.8120<br>
WildIndigoSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0288&nbsp;&nbsp;&nbsp;&nbsp; 0.0046&nbsp; 6.2798&nbsp;&nbsp; 0.0000<br>
NearestWildIndigo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0098&nbsp;&nbsp;&nbsp;&nbsp; 0.0031 -3.1678&nbsp;&nbsp; 0.0015<br>
DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0048&nbsp;&nbsp;&nbsp;&nbsp; 0.0009 -5.6024&nbsp;&nbsp; 0.0000<br>
DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0028&nbsp;&nbsp;&nbsp;&nbsp; 0.0015 -1.8989&nbsp;&nbsp; 0.0576<br>
Slope&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0100&nbsp;&nbsp;&nbsp;&nbsp; 0.0513 -0.1959&nbsp;&nbsp; 0.8447<br>
cos(SlopeAspect/360 * 2 * pi)&nbsp;&nbsp; 0.3017&nbsp;&nbsp;&nbsp;&nbsp; 0.2609&nbsp; 1.1561&nbsp;&nbsp; 0.2476<br>
</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod1.5 &lt;- update(mod1a, .~. - cos(SlopeAspect/360*2*pi))</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> round(summary(mod1.5)$coefficients,4)</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)<br>
  (Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.4783&nbsp;&nbsp;&nbsp;&nbsp; 0.3798 -1.2592&nbsp;&nbsp; 0.2080<br>
  TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0118&nbsp;&nbsp;&nbsp;&nbsp; 0.0064&nbsp; 1.8519&nbsp;&nbsp; 0.0640<br>
  WildIndigoSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0251&nbsp;&nbsp;&nbsp;&nbsp; 0.0036&nbsp; 7.0083&nbsp;&nbsp; 0.0000<br>
  NearestWildIndigo&nbsp;&nbsp;&nbsp; -0.0092&nbsp;&nbsp;&nbsp;&nbsp; 0.0024 -3.9142&nbsp;&nbsp; 0.0001<br>
  DistanceNearestTree&nbsp; -0.0022&nbsp;&nbsp;&nbsp;&nbsp; 0.0004 -4.9592&nbsp;&nbsp; 0.0000<br>
  DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0023&nbsp;&nbsp;&nbsp;&nbsp; 0.0012 -1.8910&nbsp;&nbsp; 0.0586<br>
  Slope&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0513&nbsp;&nbsp;&nbsp;&nbsp; 0.0402 -1.2768&nbsp;&nbsp; 0.2017</span>
<p><span class="style8">Slope</span> is not significant so I drop it next.<br>
</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod2 &lt;- update(mod1.5, .~.-Slope)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> round(summary(mod2)$coefficients,4)</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)<br>
  (Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.5813&nbsp;&nbsp;&nbsp;&nbsp; 0.3713 -1.5656&nbsp;&nbsp; 0.1175<br>
  TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0106&nbsp;&nbsp;&nbsp;&nbsp; 0.0063&nbsp; 1.6879&nbsp;&nbsp; 0.0914<br>
  WildIndigoSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0247&nbsp; &nbsp;&nbsp;&nbsp;0.0035&nbsp; 6.9579&nbsp;&nbsp; 0.0000<br>
  NearestWildIndigo&nbsp;&nbsp;&nbsp; -0.0093&nbsp;&nbsp;&nbsp;&nbsp; 0.0024 -3.9494&nbsp;&nbsp; 0.0001<br>
  DistanceNearestTree&nbsp; -0.0022&nbsp;&nbsp;&nbsp;&nbsp; 0.0004 -4.8832&nbsp;&nbsp; 0.0000<br>
DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0023&nbsp;&nbsp;&nbsp;&nbsp; 0.0012 -1.9111&nbsp;&nbsp; 0.0560</span>
<h3><strong>Dealing with nonlinear variables</strong></h3>
<p>At this point all the terms remaining in the model were also in our final GAM model. I examine the graphs of their smooths.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">plot(gam3, pages=1, scale=0)</div><br>
<table width="620" border="0" align="center">
  <tr>
    <th scope="col"><img src="../../images/assignments/finalpart2/fig3a.png" width="590" height="350" alt="fig. 3"></th>
  </tr>
  <tr>
    <td class="styleArial"><p style="padding-left: 45px; text-indent:-45px"><strong>Fig. 3</strong>&nbsp;&nbsp;Plots of the estimated smooths from a generalized additive model (GAM)</td>
  </tr>
</table>
<p><span class="style8">NearestWildIndigo</span> and <span class="style8">DirectionTree</span> look linear. <span class="style8">DirectionTree</span> has some other issues that we'll deal with later. The remaining variables look nonlinear. The smooth for <span class="style8">TotalCanopy</span> looks very much like a quadratic function. I try that next.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod3 &lt;- update(mod2, .~. + I(TotalCanopy^2))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> round(summary(mod3)$coefficients,4)</div>
 <span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)<br>
  (Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.3772&nbsp;&nbsp;&nbsp;&nbsp; 0.4356 -5.4569&nbsp;&nbsp; 0.0000<br>
  TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.2050&nbsp;&nbsp;&nbsp;&nbsp; 0.0257&nbsp; 7.9828&nbsp;&nbsp; 0.0000<br>
  WildIndigoSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0238&nbsp;&nbsp;&nbsp;&nbsp; 0.0036&nbsp; 6.5535&nbsp;&nbsp; 0.0000<br>
  NearestWildIndigo&nbsp;&nbsp;&nbsp; -0.0100&nbsp;&nbsp;&nbsp;&nbsp; 0.0026 -3.8014&nbsp;&nbsp; 0.0001<br>
  DistanceNearestTree&nbsp; -0.0006&nbsp;&nbsp;&nbsp;&nbsp; 0.0003 -2.4510&nbsp;&nbsp; 0.0142<br>
  DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0031&nbsp;&nbsp;&nbsp;&nbsp; 0.0014 -2.2048&nbsp;&nbsp; 0.0275<br>
I(TotalCanopy^2)&nbsp;&nbsp;&nbsp;&nbsp; -0.0026&nbsp;&nbsp;&nbsp;&nbsp; 0.0003 -7.3942&nbsp;&nbsp; </span><span class="style25">0.0000
</span>
<p>The quadratic term is significant. The relationship with <span class="style8">DistanceNearestTree</span> also looks quadratic. I try that next.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod4 &lt;- update(mod3, .~. + I(DistanceNearestTree^2))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> round(summary(mod4)$coefficients,4)</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)<br>
  (Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -1.6275&nbsp;&nbsp;&nbsp;&nbsp; 0.4988 -3.2626&nbsp;&nbsp; 0.0011<br>
  TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.1667&nbsp;&nbsp;&nbsp;&nbsp; 0.0279&nbsp; 5.9746&nbsp;&nbsp; 0.0000<br>
  WildIndigoSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0236&nbsp;&nbsp;&nbsp;&nbsp; 0.0037&nbsp; 6.4551&nbsp;&nbsp; 0.0000<br>
  NearestWildIndigo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0097&nbsp;&nbsp;&nbsp;&nbsp; 0.0026 -3.7544&nbsp;&nbsp; 0.0002<br>
  DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0023&nbsp;&nbsp;&nbsp;&nbsp; 0.0007 -3.2258&nbsp;&nbsp; 0.0013<br>
  DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0029&nbsp;&nbsp;&nbsp;&nbsp; 0.0014 -2.0231&nbsp;&nbsp; 0.0431<br>
  I(TotalCanopy^2) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-0.0022&nbsp;&nbsp;&nbsp;&nbsp; 0.0004 -6.0635&nbsp;&nbsp; 0.0000<br>
I(DistanceNearestTree^2)&nbsp;&nbsp; 0.0000&nbsp;&nbsp;&nbsp;&nbsp; 0.0000&nbsp; 2.6629&nbsp;&nbsp; </span><span class="style25">0.0077
</span>
<p>The quadratic term is again significant. The partial response function for <span class="style8">WidIndigoSize</span> looks like a logarithm. I replace <span class="style8">WildIndigoSize</span> with <span class="style8">log(WildIndigoSize)</span> and then compare these two models using AIC.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod5 &lt;- update(mod4, .~. - WildIndigoSize + log(WildIndigoSize))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> AIC(mod4, mod5)</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp; df&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AIC<br>
  mod4&nbsp; 8 328.4710<br>
mod5&nbsp; 8 </span><span class="style25">324.3546
</span>
<p>So the log model is preferred. The summary table of our model thus far is shown below.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> round(summary(mod5)$coefficients,4)</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std. Error z value Pr(&gt;|z|)<br>
  (Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -7.1632&nbsp;&nbsp;&nbsp;&nbsp; 1.0922 -6.5585&nbsp;&nbsp; 0.0000<br>
  TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.1651&nbsp;&nbsp;&nbsp;&nbsp; 0.0283&nbsp; 5.8258&nbsp;&nbsp; 0.0000<br>
  NearestWildIndigo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0097&nbsp;&nbsp;&nbsp;&nbsp; 0.0027 -3.6162&nbsp;&nbsp; 0.0003<br>
  DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0022&nbsp;&nbsp;&nbsp;&nbsp; 0.0007 -3.3081&nbsp;&nbsp; 0.0009<br>
  DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0029&nbsp;&nbsp;&nbsp;&nbsp; 0.0014 -2.0492&nbsp;&nbsp; 0.0404<br>
  I(TotalCanopy^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.0021&nbsp;&nbsp;&nbsp;&nbsp; 0.0004 -5.8326&nbsp;&nbsp; 0.0000<br>
  I(DistanceNearestTree^2)&nbsp;&nbsp; 0.0000&nbsp;&nbsp;&nbsp;&nbsp; 0.0000&nbsp; 2.9107&nbsp;&nbsp; 0.0036<br>
log(WildIndigoSize)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.7786&nbsp;&nbsp;&nbsp;&nbsp; 0.2441&nbsp; 7.2865&nbsp;&nbsp; 0.0000</span>
<h3><strong>The DirectionTree variable</strong></h3>
<p><span class="style8">DirectionTree</span> is a weird variable. Does it make sense to treat it as continuous? Currently the coefficient is negative and significant. So that means as the angle to the next tree gets bigger, we're less likely to find the butterfly. If we examine the variable we see that it has only a few unique values.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> unique(elfin$DirectionTree)</div>
<span class="style24">[1] 315&nbsp; 45 270&nbsp; 90&nbsp;&nbsp; 0 180 135 225</span>
<p>I try taking the sine and cosine of the angle as well as treating it as a factor.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod6a &lt;- update(mod5, .~.-DirectionTree + sin(DirectionTree/360*2*pi))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod6b &lt;- update(mod5, .~.-DirectionTree + cos(DirectionTree/360*2*pi))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod6c &lt;- update(mod5, .~.-DirectionTree + factor(DirectionTree))</div>

<div class="style10" style="padding-left: 30px; text-indent:-30px">mod6d &lt;- update(mod5, .~.-DirectionTree)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">AIC(mod5, mod6a, mod6b, mod6c, mod6d)</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AIC<br>
  mod5&nbsp;&nbsp; 8 </span><span class="style25">324.3546</span><span class="style24"><br>
  mod6a&nbsp; 8 325.6400<br>
  mod6b&nbsp; 8 328.3542<br>
  mod6c 14 325.0915<br>
  mod6d&nbsp; 7 326.6492</span>
<p>So, the linear model ranks best although the factor model comes close. The likelihood ratio tests for for both are statistically significant.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">anova(mod6d, mod6c, test='Chisq')</div>
<span class="style24">Analysis of Deviance Table</span>
<p><span class="style24">Model 1: Occupied_Unoccupied ~ TotalCanopy + NearestWildIndigo + DistanceNearestTree + <br>
  &nbsp;&nbsp;&nbsp; I(TotalCanopy^2) + I(DistanceNearestTree^2) + log(WildIndigoSize)<br>
  Model 2: Occupied_Unoccupied ~ TotalCanopy + NearestWildIndigo + DistanceNearestTree + <br>
  &nbsp;&nbsp;&nbsp; I(TotalCanopy^2) + I(DistanceNearestTree^2) + log(WildIndigoSize) + <br>
  &nbsp;&nbsp;&nbsp; factor(DirectionTree)<br>
  &nbsp; Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)&nbsp; <br>
  1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 447&nbsp;&nbsp;&nbsp;&nbsp; 312.65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
  2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 440&nbsp;&nbsp;&nbsp;&nbsp; 297.09&nbsp; 7&nbsp;&nbsp; 15.558&nbsp; </span><span class="style25">0.02948</span><span class="style24"> *<br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> anova(mod6d, mod5, test='Chisq')</div>
<span class="style24">  Analysis of Deviance Table</span>
<p><span class="style24">Model 1: Occupied_Unoccupied ~ TotalCanopy + NearestWildIndigo + DistanceNearestTree + <br>
  &nbsp;&nbsp;&nbsp; I(TotalCanopy^2) + I(DistanceNearestTree^2) + log(WildIndigoSize)<br>
  Model 2: Occupied_Unoccupied ~ TotalCanopy + NearestWildIndigo + DistanceNearestTree + <br>
  &nbsp;&nbsp;&nbsp; DirectionTree + I(TotalCanopy^2) + I(DistanceNearestTree^2) + <br>
  &nbsp;&nbsp;&nbsp; log(WildIndigoSize)<br>
  &nbsp; Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)&nbsp; <br>
  1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 447&nbsp;&nbsp;&nbsp;&nbsp; 312.65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
  2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 446&nbsp;&nbsp;&nbsp;&nbsp; 308.36&nbsp; 1&nbsp;&nbsp; 4.2947&nbsp; </span><span class="style25">0.03823</span><span class="style24"> *<br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<p>As a final comparison I plot the partial response functions for the factor model and the linear model for <span class="style8">DirectionTree</span> and superimpose them. To simplify obtaining the factor model estimates I refit the model without the intercept.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod6c.1 &lt;- update(mod5, .~. - DirectionTree + factor(DirectionTree)-1)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> coef(mod6c.1)</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NearestWildIndigo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DistanceNearestTree <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.636235e-01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -1.006312e-02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.325251e-03 <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I(TotalCanopy^2) I(DistanceNearestTree^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(WildIndigoSize) <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.134585e-03&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.642030e-07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.819255e+00 <br>
  &nbsp; factor(DirectionTree)0&nbsp; factor(DirectionTree)45&nbsp; factor(DirectionTree)90 <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -7.436173e+00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -7.552560e+00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -7.466269e+00 <br>
  factor(DirectionTree)135 factor(DirectionTree)180 factor(DirectionTree)225 <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -7.189403e+00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -7.617518e+00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -8.528675e+00 <br>
  factor(DirectionTree)270 factor(DirectionTree)315 <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -7.221354e+00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -9.034128e+00 </span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> coef(mod5)</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TotalCanopy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NearestWildIndigo <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -7.163231e+00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.651143e-01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -9.659265e-03 <br>
  &nbsp;&nbsp;&nbsp;&nbsp; DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I(TotalCanopy^2) <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.172650e-03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.942651e-03&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.128156e-03 <br>
  I(DistanceNearestTree^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log(WildIndigoSize) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.503037e-07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.778623e+00</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"></div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> plot(c(0,45,90,135,180,225,270,315), coef(mod6c.1)[7:14], type='b', ylab='logit', xlab=&quot;DirectionTree&quot;)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">abline(coef(mod5)[1], coef(mod3)[6], lty=2)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">legend('bottomleft', c('factor model', 'linear model'), lty=c(1,2), pch=c(1,NA), bty='n', cex=.9)</div>
<br>
<table width="550" border="0" align="center">
  <tr>
    <th scope="col"><img src="../../images/assignments/finalpart2/fig3pt1.png" width="410" height="250" alt="fig 3"></th>
  </tr>
  <tr>
    <td><p class="styleArial" style="padding-left: 45px; text-indent:-45px" span><strong>Fig. 3</strong>&nbsp;&nbsp;Fitted relationship between logit and DirectionTree variable: individual estimates for each angle from a factor model as well as the estimated linear relationship.</td>
  </tr>
</table>
<p>It's difficult to tell if <span class="style8">DirectionTree</span> is capturing anything real  in the data. The means for individual angles show an extreme amount of variability about the regression line.</p>
<h3><strong>Including interactions</strong> based on the classification tree</h3>
<p>Because <span class="style8">TotalCanopy</span> appears repeatedly on the right branch of the classification tree, it suggests that the response may have a nonlinear relationship with <span class="style8">TotalCanopy</span>. The GAM has already suggested a quadratic relationship so we don't learn anything more about nonlinearities from looking at the classification tree.</p>
<p>The variables <span class="style8">TotalCanopy</span>, <span class="style8">WildIndigoSize</span>, and <span class="style8">DistanceNearestTree</span> occur along a single branch of the classification tree. This may indicate that in an ordinary logistic regression model including interactions between <span class="style8">TotalCanopy</span>, <span class="style8">WildIndigoSize</span>, and <span class="style8">DistanceNearestTree</span> might be a good choice. On the other hand the right branch also includes <span class="style8">TotalCanopy</span> and <span class="style8">WildIndigoSize</span> with nearly the same split value for <span class="style8">WildIndigoSize</span>. So perhaps only one of the component two-factor interactions is required. I try adding an interaction between these three variables. Each of the variables has a modified form in the model, two of them are quadratic and one is logged, so choosing the proper form for the interaction is complicated. For instance we could choose to involve the quadratic terms.</p>

<div class="style10" style="padding-left: 30px; text-indent:-30px"> mod6 &lt;- update(mod5, .~. + TotalCanopy * log(WildIndigoSize) * DistanceNearestTree)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> anova(mod5, mod6, test='Chisq')</div>
<span class="style24">Analysis of Deviance Table</span>
<p><span class="style24">Model 1: Occupied_Unoccupied ~ TotalCanopy + NearestWildIndigo + DistanceNearestTree + <br>
  &nbsp;&nbsp;&nbsp; DirectionTree + I(TotalCanopy^2) + I(DistanceNearestTree^2) + <br>
  &nbsp;&nbsp;&nbsp; log(WildIndigoSize)<br>
  Model 2: Occupied_Unoccupied ~ TotalCanopy + NearestWildIndigo + DistanceNearestTree + <br>
  &nbsp;&nbsp;&nbsp; DirectionTree + I(TotalCanopy^2) + I(DistanceNearestTree^2) + <br>
  &nbsp;&nbsp;&nbsp; log(WildIndigoSize) + TotalCanopy:log(WildIndigoSize) + TotalCanopy:DistanceNearestTree + <br>
  &nbsp;&nbsp;&nbsp; DistanceNearestTree:log(WildIndigoSize) + TotalCanopy:DistanceNearestTree:log(WildIndigoSize)<br>
  &nbsp; Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)<br>
  1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 446&nbsp;&nbsp;&nbsp;&nbsp; 308.36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
  2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 442&nbsp;&nbsp;&nbsp;&nbsp; 301.11&nbsp; 4&nbsp;&nbsp; 7.2454&nbsp;&nbsp; </span><span class="style25">0.1235
  </span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> anova(mod6, test='Chisq')</div>
<span class="style241">  Analysis of Deviance Table</span>
<p><span class="style241">Model: binomial, link: logit</span>
<p><span class="style241">Response: Occupied_Unoccupied</span>
<p><span class="style241">Terms added sequentially (first to last)</span>
<p><span class="style241">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Df Deviance Resid. Df Resid. Dev&nbsp; Pr(&gt;Chi)&nbsp;&nbsp;&nbsp; <br>
  NULL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 453&nbsp;&nbsp;&nbsp;&nbsp; 625.85&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
  TotalCanopy&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp; 21.830&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 452&nbsp;&nbsp;&nbsp;&nbsp; 604.02 2.979e-06 ***<br>
  NearestWildIndigo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 55.862&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 451&nbsp;&nbsp;&nbsp;&nbsp; 548.16 7.772e-14 ***<br>
  DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 65.682&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 450&nbsp;&nbsp;&nbsp;&nbsp; 482.47 5.298e-16 ***<br>
  DirectionTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 3.590&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 449&nbsp;&nbsp;&nbsp;&nbsp; 478.88&nbsp; 0.058122 .&nbsp; <br>
  I(TotalCanopy^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 87.980&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 448&nbsp;&nbsp;&nbsp;&nbsp; 390.90 &lt; 2.2e-16 ***<br>
  I(DistanceNearestTree^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp; 10.481&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 447&nbsp;&nbsp;&nbsp;&nbsp; 380.42&nbsp; 0.001206 ** <br>
  log(WildIndigoSize)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 72.069&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 446&nbsp;&nbsp;&nbsp;&nbsp; 308.35 &lt; 2.2e-16 ***<br>
  TotalCanopy:log(WildIndigoSize)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 0.951&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 445&nbsp;&nbsp;&nbsp;&nbsp; 307.40&nbsp; 0.329508&nbsp;&nbsp;&nbsp; <br>
  TotalCanopy:DistanceNearestTree&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 1.100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 444&nbsp;&nbsp;&nbsp;&nbsp; 306.30&nbsp; 0.294269&nbsp;&nbsp;&nbsp; <br>
  DistanceNearestTree:log(WildIndigoSize)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 0.157&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 443&nbsp;&nbsp;&nbsp;&nbsp; 306.15&nbsp; 0.691767&nbsp;&nbsp;&nbsp; <br>
  TotalCanopy:DistanceNearestTree:log(WildIndigoSize)&nbsp; 1&nbsp;&nbsp;&nbsp; 5.037&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 442&nbsp;&nbsp;&nbsp;&nbsp; 301.11&nbsp; </span><span class="style25">0.024805</span><span class="style241"> *&nbsp; <br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> AIC(mod5,mod6)</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp; df&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AIC<br>
 mod5&nbsp; 8 </span><span class="style25">324.3546</span><span class="style24"><br>
 mod6 12 325.1091</span>
<p> The three-factor interaction by itself is significant (p= 0.024). The principle of marginality requires that if we add a three-factor interaction to model then we must also add all the component two-factor interactions and main effects. If we carry out a likelihood ratio test of all the interactions simultaneously the test statistic is not significant (p = 0.125). In addition the AIC is higher for the three-factor interaction model (325.1 versus 324.3).
</p>
<h2>Question 4</h2>
<h3><strong>Classification tree</strong></h3>
<p>The <span class="style4">predict</span> function applied to a classification tree yields the predicted probabilities of each response category separately for each observation.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">predict(out2a)[1:4,]</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>
[1,] 0.833333 0.1666667<br>
[2,] 0.929134 0.0708661<br>
[3,] 0.929134 0.0708661<br>
[4,] 0.078125 0.9218750</span>
<p>In each row of the output from <span class="style4">predict</span> the entry with the larger probability is the prediction for that observation. Because the values sum to 1 in each row, the prediction is the entry whose value exceeds 0.5. </p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">table(as.numeric(predict(out2a)[,2]&gt;=.5), elfin$Occupied_Unoccupied)</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 1<br>
&nbsp; 0 215&nbsp; 21<br>
&nbsp; 1&nbsp; 32 186 </span>
<p>We could also have obtained this by using the <span class="style22">type='class'</span> argument of <span class="style161">predict</span>.
<div class="style10" style="padding-left: 30px; text-indent:-30px"> predict(out2a, type='class')[1:4]</div>
<span class="style24">  [1] 0 0 0 1<br>
Levels: 0 1</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px">table(predict(out2a, type='class'), elfin$Occupied_Unoccupied)</div>
<span class="style24">  &nbsp;&nbsp; <br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 1<br>
  &nbsp; 0 215&nbsp; 21<br>
&nbsp; 1&nbsp; 32 186</span>
<p>I calculate the fraction of correct predictions.
<div class="style10" style="padding-left: 30px; text-indent:-30px">sum(diag(table(as.numeric(predict(out2a)[,2]&gt;=.5), elfin$Occupied_Unoccupied)))/ sum(table(as.numeric(predict(out2a)[,2]&gt;=.5), elfin$Occupied_Unoccupied))</div>
<span class="style24">[1] 0.88326</span>
<p>88.3% of the observations are classified correctly as true positives and true negatives.</p>
<p><strong>GAM</strong>&nbsp;</p>
<p>For the GAM I use model <span class="style8">gam3</span> with five smooths.</p>
<p class="style1">s(TotalCanopy) + s(WildIndigoSize) + s(DistanceNearestTree)  + s(NearestWildIndigo) + s(DirectionTree)</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">table(as.numeric(fitted(gam3)&gt;.5), elfin$Occupied_Unoccupied)</div>
<span class="style24"> &nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 1<br>
&nbsp; 0 213&nbsp; 29<br>
&nbsp; 1&nbsp; 34 178</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px">sum(diag(table(as.numeric(fitted(gam3)&gt;.5), elfin$Occupied_Unoccupied)))/sum(table(as.numeric(fitted(gam3)&gt;.5), elfin$Occupied_Unoccupied))</div>
<span class="style24">[1] 0.8612335</span>
<p>86.1% of the observations are classified correctly as true positives and true negatives. </p>
<h3 style="padding-left: 30px; text-indent:-30px"><strong>Logistic regression</strong></h3>
<p style="padding-left: 30px; text-indent:-30px">For the logistic regression model I use model <span class="style8">mod5</span>.</p>
<p class="style1" style="padding-left: 30px; text-indent:-30px">Occupied_Unoccupied ~ TotalCanopy + NearestWildIndigo + DistanceNearestTree + DirectionTree + I(TotalCanopy^2) + I(DistanceNearestTree^2) + log(WildIndigoSize)</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> table(as.numeric(fitted(mod5)&gt;.5), elfin$Occupied_Unoccupied)</div>
<span class="style24"> &nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 1<br>
&nbsp; 0 212&nbsp; 30<br>
&nbsp; 1&nbsp; 35 177</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px">sum(diag(table(as.numeric(fitted(mod5)&gt;.5), elfin$Occupied_Unoccupied)))/ sum(table(as.numeric(fitted(mod5)&gt;.5), elfin$Occupied_Unoccupied))</div>
<p class="style24">[1] 0.8568282</p>
<p>85.7% of the observations are classified correctly as true positives and true negatives.
</p>

<div align="center"><span class="styleArial"><strong>Table 2</strong> &nbsp;Confusion matrices (using <em>c</em> = 0.5) for four different models</span><br>
</div>
<table width="600" border="1" align="center">
  <tr  bgcolor="#F1D2D8">
    <th scope="col">Classification tree</th>
    <th scope="col">Generalized additive model</th>
  </tr>
  <tr>
    <td><div align="center"><img src="../../images/assignments/finalpart2/confusion1.gif" width="225" height="118" alt="confusion1"></div></td>
    <td><div align="center"><img src="../../images/assignments/finalpart2/confusion3.gif" width="223" height="118" alt="GAM"></div></td>
  </tr>
  <tr  bgcolor="#F1D2D8">
    <th scope="col">Logistic regression <span class="style9"><br>
    </span></th>
    <th scope="col">Logistic regression (with interactions)</th>
  </tr>
  <tr>
    <td><div align="center"><img src="../../images/assignments/finalpart2/confusion2.gif" width="225" height="118" alt="logistic"></div></td>
    <td><div align="center"><img src="../../images/assignments/finalpart2/confusion4.gif" width="223" height="118" alt="confusion"></div></td>
  </tr>
</table>
<p>Both the classification tree and GAM models beat the logistic regression model in having both fewer false positive and false negatives. The classification tree has individually the fewest number of false positives and false negatives of the  three models.</p>
<h2>Question 5</h2>
<p>I display the ROC curves for the logistic model, the GAM, and the classification tree. As we saw in Question 3, applying the <span class="style4">predict</span> function to a classification tree yields the probability of 0 (column 1) and the probability of 1 (column 2). For the ROC curve we need the probability of 1.
<br>
<div class="style10" style="padding-left: 30px; text-indent:-30px"></div>
 <div class="style15" style="padding-left: 30px; text-indent:-30px">#get the classification tree probability of   category 1</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> tree.pred &lt;- predict(out2a)[,2]</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> library(ROCR)</div>
 <div class="style15" style="padding-left: 30px; text-indent:-30px">#prediction objects</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> pred.logist1 &lt;- prediction(fitted(mod5), elfin$Occupied_Unoccupied)</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"></div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> pred.gam &lt;- prediction(fitted(gam3), elfin$Occupied_Unoccupied)</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> pred.tree &lt;- prediction(tree.pred, elfin$Occupied_Unoccupied)</div>
 <div class="style15" style="padding-left: 30px; text-indent:-30px">#performance objects</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> perf.logist1 &lt;- performance(pred.logist1, 'tpr', 'fpr')</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"></div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> perf.gam &lt;- performance(pred.gam, 'tpr', 'fpr')</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> perf.tree &lt;- performance(pred.tree, 'tpr', 'fpr')</div>
 <div class="style15" style="padding-left: 30px; text-indent:-30px">#create the graph</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> plot(perf.logist1@x.values[[1]], perf.logist1@y.values[[1]], type='s', ylab='True positive rate (TPR)', xlab='False positive rate (FPR)', col=2, lwd=2)</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px">lines(perf.tree@x.values[[1]], perf.tree@y.values[[1]], type='s', col='grey60', lwd=2)</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"></div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> lines(perf.gam@x.values[[1]], perf.gam@y.values[[1]], type='s', col=4, lty=1)</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px">legend('bottomright', c('logistic', 'GAM', 'classification tree'), col=c(2,4,'grey60'),lty=c(1,1,1), lwd=c(2,1,2), cex=.9, bty='n', title=expression(bold('Model')))</div>
 <br>
<table width="500" border="0" align="center">
   <tr>
     <th scope="col"><img src="../../images/assignments/finalpart2/fig5.png" width="450" height="285" alt="ROC"></th>
   </tr>
   <tr>
     <td><p class="styleArial" style="padding-left: 45px; text-indent:-45px"><strong>Fig. 5</strong>&nbsp;&nbsp;ROC curves for a logistic regression model, a five-variable GAM, and a classification tree.</td>
   </tr>
 </table>
 <h2>Question 6</h2>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> auc.vals &lt;- sapply(list(pred.logist1,  pred.gam, pred.tree), function(x) performance(x, 'auc')@y.values[[1]][1])</div>
 <div class="style10" style="padding-left: 30px; text-indent:-30px"> names(auc.vals) &lt;- c('logistic', 'GAM', 'tree')</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">auc.vals</div>
<span class="style24"> &nbsp;logistic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tree <br>
0.9284359 0.9338536 0.9136302</span>
<p>All of these values are exceedingly high.<br>
 </p>
<h2>Question 7</h2>
 <p>Because the classification tree has only six splits, its ROC curve has six jumps. Because the logistic regression model and the GAM treat the variables as continuous, their ROC curves are much smoother. As a result the AUC for these models exceed that of the classification tree. Thus for certain cut-points (0.5 for instance) the classification tree beats both logistic regression models (although rarely the GAM) but on average it does worse. So surprisingly the parametric and semi-parametric models beat the algorithmic approach here. The GAM is the clear winner but does so perhaps by sacrificing interpretability and  overfitting the data. In truth all four models do a spectacular job of classification here.</p>
<hr align="center" width="75%">
<p align="center"><img src="../../images/assignments/finalpart2/HWfinal2.png" width="370" height="210" alt="HW scores"></p>
<p align="center"><a href="../../index.html">Course Home Page</a> </p>
<!--Standard footer follows -->
<p></p>
<table width="586" border="3" cellspacing="2" cellpadding="2" align=
"CENTER">
  <tr bgcolor="#CCCCCC">
    <td width="100%"><font size=-1>Jack Weiss<br>
      <i>Phone: </i>(919) 962-5930<br>
      <i>E-Mail:</i> jack_weiss@unc.edu<br>
      <i>Address: </i>Curriculum for the Environment and Ecology, Box 3275, University of North Carolina, Chapel Hill, 27599<br>
      Copyright &copy; 2012<br>
      Last Revised--May 2, 2012<br>
      URL: <a href="finalpart2.htm#finalpart2" target="_self">https://sakai.unc.edu/access/content/group/2842013b-58f5-4453-aa8d-3e01bacbfc3d/public/Ecol562_Spring2012/docs/solutions/finalpart2.htm</a></font></td>
  </tr>
</table>
<p align="center">&nbsp;</p>
</body>
</html>
