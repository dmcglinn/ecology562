<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Lecture 23&mdash;Friday, March 2, 2012</title>

<style type="text/css">
<!--
a:link {color: #0000CC; text-decoration:none}
a:visited {color: #0000CC; text-decoration:none}
a:hover {color: green; text-decoration:underline; background:#F9EDED}
a:active {color: red; text-decoration:none}
div.figure {float:none;width=25%;}
div.figure p {test-align: center;font-style:italic;}
div.figureL {float:left;width=50%; margin:1.5em;padding:4px 4px 4px 0px;}
div.figureL p {test-align: center;font-style:italic;}
div.figureR {float:right;width=50%;margin:1.5em;padding:3px 4px 4px 0px;}
div.figureR p {test-align: center;font-family: Arial, Helvetica, sans-serif;font-size:11.0pt;}

.subtd {margin-left: 2em;}

.subtd2 {margin-left: 2em;
   margin-right: 2em;}
.eq { width: 100%; }
.eq th { text-align: right;
         vertical-align: absolute middle;
		 font-weight: normal; }
		 
.style4 {	color: #CC0000;
	font-weight: bold;
}
.style11 {font-family: "Courier New", Courier, mono;}
.style22 {color: #663366; font-weight: bold; }
.style10 {
	font-family: "Courier New", Courier, mono;
	color: #000000;
	background-color:#F0F0F0;
}
.style33 {
	font-family: "Courier New", Courier, mono;
	color: #000000;
	background-color:#FFFACD;
}

.style34 {font-family: "Courier New", Courier, mono; color: #339933; font-weight: bold; background-color:#FFFACD; }
.style43 {color: #0000FF; font-weight: bold; font-family: "Courier New", Courier, mono;  background-color:#FFFACD;}



.style25 {
	font-family: "Courier New", Courier, mono;
	color: #003399;
	font-size:small;
	background-color:#FFFC9A;
}

.style35 {color: #339933; font-weight: bold; font-family: "Courier New", Courier, mono; }
.style15 {font-family: "Courier New", Courier, mono; color: #339933; font-weight: bold; background-color:#F0F0F0; }

.style16 {font-family: "Courier New", Courier, mono; color: #339933; font-weight: bold;background-color:#C5E9EB; }
.style17 {font-family: "Courier New", Courier, mono; color: #339933; font-weight: bold; }

.style19 {color: #339933;
	font-weight: bold;}
.style40 {color: #0000FF; font-weight: bold; font-family: "Courier New", Courier, mono;}
.style42 {color: #0000FF; font-weight: bold; font-family: "Courier New", Courier, mono;  background-color:#F0F0F0;}

.style1 {font-family: "Courier New", Courier, mono;}

.sasnavy {font-size:11.0pt;font-family:"Courier New"; font-weight: bold;
color:navy;background:white; }

.sasblack {font-size:11.0pt;font-family:"Courier New";
color:black;background:white; }

.sasblue {font-size:11.0pt;font-family:"Courier New";
color:blue;background:white; }

.saspurple {font-size:11.0pt;font-family:"Courier New";
color:purple;background:white; }

.sasteal {font-size:11.0pt;font-family:"Courier New";
color:teal;background:white; }

.sasgreen {font-size:11.0pt;font-family:"Courier New";
color:green;background:white; }

.sasblack9 {font-size:9.0pt;font-family:"Courier New";
color:black;background:white; }

.sasblue9 {font-size:9.0pt;font-family:"Courier New";
color:blue;background:white; }
.style41 {	color: #00C;
	font-weight: bold;
}

.style61 {	color: #000000;
	font-weight: bold;
}

.styleArial {
	font-family: Arial, Helvetica, sans-serif;font-size:11.0pt;
}
.styleArial2 {
	font-family: Arial, Helvetica, sans-serif;
}
.style66 {
	font-family: Arial, Helvetica, sans-serif;
}
.stylecayenne {
	color: #800000;
}
.style44 {font-family: "Courier New", Courier, mono}
.style9 {	color: #339900;
	font-weight: bold;
}
.style101 {font-family: "Courier New", Courier, mono}


.style24 {
	font-family: "Courier New", Courier, mono;
	color: #0000FF;
	font-size:small;
}


.style8 {
	font-family: Arial, Helvetica, sans-serif;
	color: #810000;
}

.style14 {color: #0000FF; font-size: smaller; font-family: "Courier New", Courier, mono; }
.style14 {color: blue;
	font-family: "Courier New", Courier, mono;}
.style151 {font-family: "Courier New", Courier, mono; color: #009900; }
.style31 {color: #336699; font-weight: bold; }
.style32 {color: #333333;
	font-weight: bold;
}
.style3 {	color: #CC0000;
	font-weight: bold;
}
.style36 {color: #CC0033; font-weight: bold; }
.style102 {font-size: smaller}
.style6 {	color: #0033CC;
	font-size: smaller;
}
.style7 {	color: #CC0000;
	font-weight: bold;
}
div.figureR1 {float:right;width=50%;margin:1.5em;padding:4px 4px 4px 0px;}
.style103 {color: #0033CC; font-size: smaller; font-family: "Courier New", Courier, mono; }
.style1021 {color: #CC0000;
	font-weight: bold;
}
.style361 {color: #660099;
	font-weight: bold;
}
-->
</style>
</head>

<body>
<h1 align="center"><a name="lecture23" id="lecture23"></a>Lecture 23 (lab 8)&mdash;Friday, March 2, 2012</h1>
<h2>Topics</h2>
<ul>
  <li><a href="lecture23.htm#background">Background on the data</a></li>
  <li><a href="lecture23.htm#Rgee">Generalized estimating equations using the gee package</a></li>
  <li><a href="lecture23.htm#choosing">Choosing a correlation structure</a></li>
  <li><a href="lecture23.htm#Rgeepack">Generalized estimating equations using the geepack package</a></li>
  <li><a href="lecture23.htm#binary">A binary mixed effects model</a></li>
  <li><a href="lecture23.htm#comparing">Comparing marginal and subject-specific models</a></li>
  <li><a href="lecture23.htm#checking">Checking the correlations for feasibility</a></li>
  <li><a href="lecture23.htm#cited">Cited references</a></li>
</ul>
<h3>R functions and commands demonstrated</h3>
<ul>
  <li><a href="lecture23.htm#gee">gee</a> (from <span class="style19">gee</span>) for fitting GEE models.</li>
  <li><a href="lecture23.htm#geeglm">geeglm</a> (from <span class="style19">geepack</span>) for fitting GEE models.</li>
  <li><a href="lecture23.htm#binary">lmer</a> (from <span class="style19">lme4</span>) sets up and fits generalized linear and nonlinear mixed effects models.</li>
  <li><a href="lecture23.htm#waves">paste</a> concatenates text strings together.</li>
</ul>
<h3>R function options</h3>
<ul>
  <li><a href="lecture23.htm#corstr">corstr=</a> (argument to <span class="style1021">gee</span> and <span class="style1021">geeglm</span>) for defining the correlation structure within groups in a GEE model.</li>
  <li><a href="lecture23.htm#id">id=</a> (argument to<span class="style1021"> gee</span> and <span class="style1021">geeglm</span>) is used to identify the grouping variable in a GEE model.</li>
  <li><a href="lecture23.htm#Mv">Mv</a>= (argument to <span class="style1021">gee</span>) for specifying the order of an autoregressive process or the order of a stationary or nonstationary M dependent correlation matrix.</li>
  <li><a href="lecture23.htm#scalefix">scale.fix</a>= (argument to<span class="style1021"> gee</span> and <span class="style1021">geeglm</span>) when set to TRUE causes the scale parameter to be fixed (by default at 1) rather than estimated.</li>
  <li>s<a href="lecture23.htm#waves">ep=</a> (argument to <span class="style1021">paste</span>) identifies the value that should be used to separate the concatenated text strings.</li>
  <li><a href="lecture23.htm#waves">waves=</a> (argument to <span class="style1021">geeglm</span>) names a positive integer-valued variable that is used to identify the order and spacing of observations within groups in a GEE model. This argument is crucial when there are missing values and gaps in the data.</li>
  <li><a href="lecture23.htm#zcor">zcor=</a> (argument to <span class="style1021">geeglm</span>) is used to specify the entries of a correlation matrix to accompany <span class="style22">corstr=&quot;fixed&quot;</span>.</li>
</ul>
<h3>R packages used </h3>
<ul>
  <li><a href="lecture23.htm#Rgee">gee</a> used for the function <span class="style1021">gee</span> to fit GEE models.</li>
  <li><a href="lecture23.htm#Rgeepack">geepack</a> used for the function <span class="style1021">geeglm</span> to fit GEE models.</li>
  <li><a href="lecture23.htm#binary">lme4</a> used for the function <span class="style1021">lmer</span> to fit generalized linear mixed effects models.</li>
</ul>
<h2><a name="background" id="background"></a>Background on the data</h2>
<p>To illustrate the process of fitting GEE models in R, we use some binary data analyzed in Fieberg et al. (2009). The goal of their study was to relate nest occupancy by mallards (a binary response) to surrounding land use characteristics and the type of nesting structure that was provided. The authors provide R code for their analysis in a supplemental document. As we'll see, the authors made some mistakes in fitting their models. </p>
<p> Individual nests were observed repeatedly over time and at each time point the nest was classified as occupied (<span class="style8">nesting2</span> = 1) or unoccupied (<span class="style8">nesting2</span> = 0) by mallards. If the nest was occupied by a  species other than mallard, no data were recorded or <span class="style8">nesting2</span> was assigned a missing value, NA. The available predictors include the following.</p>
<ul>
  <li><span class="style8">year</span>: the year of the observation (1997, 1998, 1999)</li>
  <li><span class="style8">period</span>: the seasonal observation period (1, 2, 3, 4)</li>
  <li><span class="style8">deply</span>: nest structure type (1 for single cylinder, 2 for double cylinder)</li>
  <li><span class="style8">size</span>: the size of the wetland in which the nest structure was located</li>
  <li><span class="style8">rblval</span>: a measure of visual obstruction around the nest</li>
</ul>
<p>A variable <span class="style8">strtno</span> identifies the  site at which measurements were made. Of these variables, <span class="style8">deply</span> and <span class="style8">size</span> were constant for a given nest site, while <span class="style8">year</span>, <span class="style8">period</span>, and <span class="style8">rblval</span> varied over time. </p>
<p>I load the data that I previously downloaded to my laptop and display part of the records for the first two nesting sites in the data set.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">sm <- read.table( 'ecol 562/sm003.txt', header=T, sep=',')</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">sm[1:16,]</div>
<span class="style24"> &nbsp;&nbsp; strtno year period&nbsp;&nbsp;&nbsp; rblval deply nesting2&nbsp; size<br>
1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.2255628&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 24.00<br>
2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.2274146&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 24.00<br>
3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 0.8913011&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 24.00<br>
4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.0374570&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 24.00<br>
5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.3563867&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 24.00<br>
6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.3886405&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 24.00<br>
7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1.2367539&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;1 24.00<br>
8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.1414228&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 24.00<br>
9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.3138169&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 24.00<br>
10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.4468211&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 24.00<br>
11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1.3173710&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 24.00<br>
12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.0699900&nbsp;&nbsp;&nbsp; &nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 24.00<br>
13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.2280539&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 7.19<br>
14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.2280767&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 7.19<br>
15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 0.8641539&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 7.19<br>
16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.0086747&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 7.19</span>
<p>The largest number of observations per nest is 12, but some of the nests have fewer than 12 observations.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> max(table(sm$strtno))</div>
<span class="style24"> [1] 12</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> names(table(sm$strtno))[table(sm$strtno)&lt;12]</div>
<span class="style24">&nbsp;[1] &quot;4&quot;&nbsp;&nbsp; &quot;30&quot;&nbsp; &quot;32&quot;&nbsp; &quot;36&quot;&nbsp; &quot;56&quot;&nbsp; &quot;59&quot;&nbsp; &quot;61&quot;&nbsp; &quot;62&quot;&nbsp; &quot;64&quot;&nbsp; &quot;65&quot; &nbsp;&quot;75&quot; <br>
[12] &quot;77&quot;&nbsp; &quot;86&quot;&nbsp; &quot;103&quot; &quot;106</span>
<p>I examine the data from some of the nests with fewer than the maximum number of observations.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> sm[sm$strtno %in% c(4,30,32),]</div>
<span class="style24">&nbsp;&nbsp;&nbsp; strtno year period&nbsp;&nbsp;&nbsp; rblval deply nesting2&nbsp; size<br>
37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.1716186&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 0.31<br>
38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.1725532&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 0.31<br>
39&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 0.8508596&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 0.31<br>
40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1.9599569&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 0.31<br>
41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.3177463&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 0.31<br>
42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.3015640&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 0.31<br>
43&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1.0184868&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 0.31<br>
44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.0650446&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 0.31<br>
345&nbsp;&nbsp;&nbsp;&nbsp; 30 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.1659685&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 26.41<br>
346&nbsp;&nbsp;&nbsp;&nbsp; 30 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.1800388&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 26.41<br>
347&nbsp;&nbsp;&nbsp;&nbsp; 30 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 0.9642473&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 26.41<br>
348&nbsp;&nbsp;&nbsp;&nbsp; 30 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.0531590&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 26.41<br>
349&nbsp;&nbsp;&nbsp;&nbsp; 30 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.1911280&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 26.41<br>
350&nbsp;&nbsp;&nbsp;&nbsp; 30 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.2608312&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 26.41<br>
351&nbsp;&nbsp;&nbsp;&nbsp; 30 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1.2013512&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 26.41<br>
352&nbsp;&nbsp;&nbsp;&nbsp; 30 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.1466754&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 26.41<br>
365&nbsp;&nbsp;&nbsp;&nbsp; 32 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.1943395&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 3.48<br>
366&nbsp;&nbsp;&nbsp;&nbsp; 32 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.2452308&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NA&nbsp; 3.48<br>
367&nbsp;&nbsp;&nbsp;&nbsp; 32 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1.2645853&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NA&nbsp; 3.48<br>
368&nbsp;&nbsp;&nbsp;&nbsp; 32 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.2661940&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 3.48<br>
369&nbsp;&nbsp;&nbsp;&nbsp; 32 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 0.1227242&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 3.48<br>
370&nbsp;&nbsp;&nbsp;&nbsp; 32 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 0.2371302&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 3.48<br>
371&nbsp;&nbsp;&nbsp;&nbsp; 32 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1.2778317&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 3.48<br>
372&nbsp;&nbsp;&nbsp;&nbsp; 32 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 2.1876824&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; 3.48</span>
<p>Nests 4 and 30 are missing the last year of data, 1999. Nest 32 is missing the first year of data but also seasons 2 and 3 in 1998. Because values for the predictors were recorded at these two times but the response, <span class="style8">nesting2</span>, is recorded as missing (NA), we conclude that the nest was being occupied by a different species. The unbalanced data and the presence of missing values in some of the records will have an impact on the way models will need to be fit. </p>
<h2><a name="Rgee" id="Rgee2"></a>Generalized estimating equations using the gee package</h2>
<p>The model Fieberg et al. (2009) choose to fit in all of their examples is one that includes main effects for the five predictors <span class="style8">year</span>, <span class="style8">period</span>, <span class="style8">rblval</span>, <span class="style8">deply</span>, and <span class="style8">size,</span> a quadratic term for <span class="style8">size</span>, and interactions between <span class="style8">period</span> and <span class="style8">year</span> as well as between <span class="style8">rblval</span> and <span class="style8">period</span>. The variables <span class="style8">year</span>, <span class="style8">period</span>, and <span class="style8">deply</span> are recorded as numeric variables in the data set but need to be treated as factors in the model. In R notation the basic logistic regression model that we'll use  is the following.</p>
<div class="style1" style="padding-left: 30px; text-indent:-30px">nesting2 ~ factor(year) + factor(period) + factor(deply) + rblval+ factor(year)*factor(period) + rblval*factor(period) + size + I(size^2), family=binomial, data=sm</div>
<p>R has two packages that fit GEE models: the <span class="style19">gee</span> package and the <span class="style19">geepack</span> package. Because there are slight differences in the algorithms used by these packages, the results returned by them are not identical. Although there is considerable overlap between the two packages, the <span class="style19">geepack</span> package offers a number of advantages  if there are missing data. </p>
<p><a name="gee"></a>We'll start with the <span class="style19">gee</span> package. The  function in this package for fitting GEE models is the <span class="style1021">gee</span> function. In addition to the  model syntax shown above <span class="style1021">gee</span> requires two additional arguments: </p>
<ol>
  <li><a name="id"></a><span class="style22">id</span>= which is used to identify the grouping variable in the data set (within which observations are correlated).  For the <span class="style8">sm</span> data set the grouping variable is <span class="style8">strtno</span>. </li>
  <li> <a name="corstr"></a><span class="style22">corstr</span>= which is used to identify the  correlation structure within groups (<span class="style22">id</span>).</li>
</ol>
<p>The <span class="style19">gee</span> package offers the following correlation structures for the <span class="style22">corstr</span> argument.</p>
<ul>
  <li><span class="style1">&quot;independence&quot;</span>: the observations within the groups are uncorrelated.</li>
  <li><span class="style1">&quot;exchangeable&quot;</span>: each pair of observations in a group has the same correlation.</li>
  <li><span class="style1">&quot;unstructured&quot;</span>: each pair of observations in a group is allowed to have a different correlation.</li>
  <li><span class="style1"><a name="Mv"></a>&quot;AR-M&quot;</span>: this is used to fit an autoregressive structure. To obtain a specific autoregressive structure requires the additional argument <span class="style22">Mv</span>. For example <span class="style1">corstr=&quot;AR-M&quot;, Mv=1</span> yields an AR(1) structure, while <span class="style1">corstr=&quot;AR-M&quot;, Mv=2</span> yields an AR(2) structure.</li>
  <li><span class="style1">&quot;non_stat_M_dep&quot;</span>: stands for nonstationary M-dependent and generates a banded correlation matrix. It also requires the <span class="style22">Mv</span> argument to denote the number of nonzero off-diagonal bands that are to be estimated. Like <span class="style1">&quot;AR-M&quot;</span>, <span class="style1">&quot;non_stat_M_dep&quot;</span> assumes there is a natural order to the data. Like <span class="style1">&quot;unstructured&quot;</span>, <span class="style1">&quot;non_stat_M_dep&quot;</span> allows  the entries within the each nonzero band to be different. As an example <span class="style1">corstr=&quot;non_stat_M_dep&quot;, Mv=1</span> would correspond to the following correlation matrix for a group of size 4. Here &alpha;, &beta;, and &gamma; are parameters that need to be estimated.</li>
</ul>
<p align="center"><img src="../../images/lectures/lecture23/nonstatMdep.gif" width="157" height="130"></p>
<ul>
  <li><span class="style1">&quot;stat_M_dep&quot;</span>: stands for stationary M-dependent and generates a banded structure. It also requires the <span class="style22">Mv</span> argument which denotes the number of nonzero bands to include. Like <span class="style1">&quot;AR-M&quot;</span>, it assumes there is a natural order to the data but differs from <span class="style1">&quot;AR-M&quot;</span> in that the entries in different bands are unconnected to each other. Within a band all the entries are assigned the same correlation parameter (unlike <span class="style1">&quot;non_stat_M_dep&quot;</span>). Mathematically the correlation matrix that is produced  is called a Toeplitz matrix. For example, <span class="style1">corstr=&quot;stat_M_dep&quot;, Mv=2</span> for a cluster of size 4 would yield the following correlation matrix. Here &alpha; and &beta; are parameters that need to be estimated.</li>
</ul>
<p align="center"><img src="../../images/lectures/lecture23/statMdep.gif" width="158" height="133" alt="statmdep"></p>
<p><a name="scalefix"></a>Because we are working with binary data we need to include one further argument: <span class="style1">scale.fix=T</span>. This option causes the scale parameter to be fixed at its default value of 1 rather than estimated. Omitting this argument and allowing <span class="style1021">gee</span> to estimate the scale parameter generates a <a href="lecture22.htm#quasifamily">quasibinomial</a> model, which is an adjustment for overdispersion. Because binary data cannot be overdispersed, a quasibinomial model is never appropriate for binary data. For true binomial (non-binary) data and Poisson data we would typically let this argument take its default value of <span class="style1">F</span> so that a scale parameter is estimated. Note: Specifying <span class="style1">corstr=&quot;independence&quot;</span> and <span class="style1">scale.fix=F</span> yields the same result as fitting the  model with <span class="style1021">glm</span> and specifying <span class="style1">family=quasibinomial</span>. </p>
<p>To fit a GEE model with an exchangeable correlation structure to the nesting data we would enter the following.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">library(gee)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">geefit.ex&lt;-gee(nesting2~factor(year) + factor(period) + factor(deply) + rblval + factor(year)*factor(period) + rblval*factor(period) + size + I(size^2), id=strtno, family=binomial, corstr=&quot;exchangeable&quot;, scale.fix=T, data=sm)</div>
<p>The <span class="style1021">summary</span> function applied to this object provides information about the model fit. I extract some of its components individually in order to reduce the amount of output that is displayed. First I examine the scale parameter and the estimated correlation matrix.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> geefit.ex$scale</div>
<span class="style24"> [1] 1</span>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> round(summary(geefit.ex)$working.correlation,2)</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]<br>
&nbsp;[1,] 1.00 0.13 0.13 0.13 0.13 0.13 0.13 0.13 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
&nbsp;[2,] 0.13 1.00 0.13 0.13 0.13 0.13 0.13 0.13 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
&nbsp;[3,] 0.13 0.13 1.00 0.13 0.13 0.13 0.13 0.13 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
&nbsp;[4,] 0.13 0.13 0.13 1.00 0.13 0.13 0.13 0.13 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
&nbsp;[5,] 0.13 0.13 0.13 0.13 1.00 0.13 0.13 0.13 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
&nbsp;[6,] 0.13 0.13 0.13 0.13 0.13 1.00 0.13 0.13 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
&nbsp;[7,] 0.13 0.13 0.13 0.13 0.13 0.13 1.00 0.13 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
&nbsp;[8,] 0.13 0.13 0.13 0.13 0.13 0.13 0.13 1.00 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
&nbsp;[9,] 0.13 0.13 0.13 0.13 0.13 0.13 0.13 0.13 1.00&nbsp; 0.13&nbsp; 0.13&nbsp; 0.13<br>
[10,] 0.13 0.13 0.13 0.13 0.13 0.13 0.13 0.13 0.13&nbsp; 1.00&nbsp; 0.13&nbsp; 0.13<br>
[11,] 0.13 0.13 0.13 0.13 0.13 0.13 0.13 0.13 0.13&nbsp; 0.13&nbsp; 1.00&nbsp; 0.13<br>
[12,] 0.13 0.13 0.13 0.13 0.13 0.13 0.13 0.13 0.13&nbsp; 0.13&nbsp; 0.13&nbsp; 1.00</span>
<p>The scale parameter was not estimated but was fixed at 1, which is correct for binary data. The correlation between observations within a group is estimated to be 0.13. Because we specified an exchangeable correlation structure, this correlation is the same for every pair of observations within the group. What's displayed above is the full 12 &times; 12 correlation matrix for the largest group.</p>
<p>Next I examine the coefficient table of   parameter estimates.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> round(summary(geefit.ex)$coefficients,2)</div>
<span class="style24">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Naive S.E. Naive z Robust S.E. Robust z<br>
(Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -3.63&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.57&nbsp;&nbsp; -6.37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.63&nbsp;&nbsp;&nbsp; -5.77<br>
factor(year)1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.37&nbsp;&nbsp;&nbsp; 2.76&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.36&nbsp;&nbsp;&nbsp;&nbsp; 2.79<br>
factor(year)1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.95&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.38&nbsp;&nbsp;&nbsp; 2.48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.31&nbsp;&nbsp;&nbsp;&nbsp; 3.08<br>
factor(period)2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.29&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.67 &nbsp;&nbsp;&nbsp;1.91&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.71&nbsp;&nbsp;&nbsp;&nbsp; 1.82<br>
factor(period)3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.82&nbsp;&nbsp;&nbsp; 1.35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.77&nbsp;&nbsp;&nbsp;&nbsp; 1.38<br>
factor(period)4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.84&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.36&nbsp;&nbsp;&nbsp; 2.05&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.48&nbsp;&nbsp;&nbsp;&nbsp; 1.95<br>
factor(deply)2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.27&nbsp;&nbsp; -0.07&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.29&nbsp;&nbsp;&nbsp; -0.06<br>
rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.90&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.44&nbsp;&nbsp;&nbsp; 2.71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.67&nbsp;&nbsp;&nbsp;&nbsp; 2.34<br>
size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.23&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.06&nbsp;&nbsp;&nbsp; 3.97&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.06&nbsp;&nbsp;&nbsp;&nbsp; 4.10<br>
I(size^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00&nbsp;&nbsp; -3.12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00 &nbsp;&nbsp;&nbsp;-3.22<br>
factor(year)1998:factor(period)2&nbsp;&nbsp;&nbsp; -1.85&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.58&nbsp;&nbsp; -3.20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.57&nbsp;&nbsp;&nbsp; -3.26<br>
factor(year)1999:factor(period)2&nbsp;&nbsp;&nbsp; -1.21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.55&nbsp;&nbsp; -2.21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.45&nbsp;&nbsp;&nbsp; -2.66<br>
factor(year)1998:factor(period)3&nbsp;&nbsp;&nbsp; -1.48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.87&nbsp;&nbsp; -1.70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.83&nbsp;&nbsp;&nbsp; -1.79<br>
factor(year)1999:factor(period)3&nbsp;&nbsp;&nbsp; -1.12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.86&nbsp;&nbsp; -1.31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.80&nbsp;&nbsp;&nbsp; -1.41<br>
factor(year)1998:factor(period)4&nbsp;&nbsp;&nbsp; -1.62&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.67&nbsp;&nbsp; -2.40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.68&nbsp;&nbsp;&nbsp; -2.36<br>
factor(year)1999:factor(period)4&nbsp;&nbsp;&nbsp; -1.26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.63&nbsp;&nbsp; -1.99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.63&nbsp;&nbsp;&nbsp; -2.01<br>
factor(period)2:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.10&nbsp;&nbsp; -1.15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.23&nbsp;&nbsp;&nbsp; -1.08<br>
factor(period)3:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -5.11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.47&nbsp;&nbsp; -2.07&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.50&nbsp;&nbsp;&nbsp; -2.04<br>
factor(period)4:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -6.02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.88&nbsp;&nbsp; -3.21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.03&nbsp;&nbsp;&nbsp; -2.97</span>
<p>The multiple standard error columns deserve comment. It was mentioned in <a href="lecture22.htm#method3">lecture 22</a> that GEE software routinely produces two standard error estimates: a naive (or model-based) estimate and a robust (or sandwich) estimate. These are what are displayed here. The naive estimate is the standard error under the assumption that the correlation matrix has been correctly specified and estimated. The robust estimate modifies the naive estimate by a term that depends on the covariance of the model residuals across groups. It is robust in the sense that using it allows one to draw correct inferences from the data even if the correlation model was incorrectly specified. </p>
<p>Although no <em>p</em>-values are shown, the reported <em>z</em>-statistics can be treated as standard normal random variables and significance tests carried out in the usual fashion. Based on  the output it appears that our conclusions would be the same regardless of  the  standard error estimates we  use. </p>
<h2><a name="choosing" id="choosing"></a>Choosing a correlation structure</h2>
<p name="nlme">The subject of choosing a correlation structure in GEE models was discussed in <a href="lecture22.htm#choosing">lecture 22</a>. A good starting point is to pick a correlation structure that makes sense given the nature of  the data. Because these are repeated measures data, an exchangeable or an AR(1) structure are good choices. Choosing correlation structures such as unstructured and nonstationary M-dependent would be unmotivated here without additional information about the data. It is always useful to fit an independence model to serve as a reference. The next two runs  fit   an independence model and an exchangeable correlation model.</p>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#independent</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> geefit.ind &lt;- gee(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+ factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2), id=strtno,family=binomial, corstr=&quot;independence&quot;, data=sm, scale.fix=T)</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px"> #exchangeable</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> geefit.ex &lt;- gee(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval +factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2), id=strtno,family=binomial, corstr=&quot;exchangeable&quot;, data=sm, scale.fix=T)</div>
<p>Because there are missing data and gaps in the temporal series of measurements,  any  correlation model fit with the <span class="style1021">gee</span> function that depends on the order of the data  will be incorrect. The <span class="style1021">gee</span> function assumes that the non-missing observations in a group start at time = 0 and are then listed consecutively. With the <span class="style1021">gee</span> function there is no way to indicate the presence of gaps in a time series. On the other hand the <span class="style1021">geeglm</span> function in the <span class="style19">geepack</span> package doesn't have this shortcoming as will be explained <a href="lecture23.htm#Rgeepack">below</a>. Fieberg et al. (2009) fit all their models using the <span class="style19">gee</span> package but overlooked this problem. Hence the results they report for an AR(1) model fit are wrong. </p>
<p> Here's how one would ordinarily fit an unstructured, AR(1), stationary M-dependent, and nonstationary M-dependent model with the <span class="style1021">gee</span> function. Because the results are wrong for these data I won't bother to examine the output from these models.</p>
<div class="style15" style="padding-left: 30px; text-indent:-30px"> #unstructured</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> geefit.un &lt;- gee(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+ factor(year)*factor(period)+ rblval*factor(period)+ size+I(size^2), id=strtno, family=binomial, corstr=&quot;unstructured&quot;, data=sm, scale.fix=T)</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#AR(1) model--incorrect for these data</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> geefit.ar1 &lt;- gee(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+ factor(year)*factor(period)+ rblval*factor(period)+ size+I(size^2), id=strtno, family=binomial, corstr=&quot;AR-M&quot;, Mv=1,&nbsp; data=sm, scale.fix=T)</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px"> #stationary dependence model lag 1--incorrect for these data</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> geefit.M1 &lt;- gee(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2), id=strtno, family=binomial, corstr=&quot;stat_M_dep&quot;, Mv=1, data=sm, scale.fix=T)</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px"> #nonstationary dependence model lag 1--incorrect for these data</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> geefit.nM1 &lt;- gee(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2), id=strtno, family=binomial, corstr=&quot;non_stat_M_dep&quot;, Mv=1, data=sm, scale.fix=T)</div>
<p>To compare models using QIC or CIC we need to write  our own code to calculate these statistics. A function that works with <span class="style1021">gee</span> output is shown below.</p>
<div class="style1" style="padding-left: 30px; text-indent:-30px">QIC.binom.gee &lt;- function(model.R,model.independence)</div>
<div class="style1" style="padding-left: 30px; text-indent:-30px"> {</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px"> #calculates binomial QAIC of Pan (2001)</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px"> #obtain trace term of QAIC</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> AIinverse &lt;- solve(model.independence$naive.variance)</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> V.msR &lt;- model.R$robust.variance</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px">trace.term &lt;- sum(diag(AIinverse%*%V.msR))</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px">#estimated mean and observed values</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> mu.R &lt;- model.R$fitted.values</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> y &lt;- model.R$y</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px"> #scale for binary data</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> scale &lt;- 1</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px"> #quasilikelihood for binomial model</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> quasi.R &lt;- sum(y*log(mu.R/(1-mu.R))+log(1-mu.R))/scale</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px">QIC &lt;- (-2)*quasi.R + 2*trace.term</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> output &lt;- c(QIC,trace.term)</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> names(output) &lt;- c('QIC','CIC')</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> output</div>
<div class="style1" style="padding-left: 30px; text-indent:-30px"> }</div>
<p name="nlme">This function is available from the <a href="../../notes/QICbinomgee.txt">class web site</a>.
To use the function we need to specify two arguments: the model of interest (1st argument) as well as well as the independence model (2nd argument). Below I use the function to calculate QIC and CIC for the independence and exchangeable correlation models. </p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">sapply(list(geefit.ind, geefit.ex), function(x) QIC.binom.gee(x,geefit.ind))</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [,1]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [,2]<br>
QIC 830.49827 828.77187<br>
CIC&nbsp; 22.88311&nbsp; 21.03943</span>
<p>Both QIC and CIC rate the exchangeable model as best.</p>
<p>As was discussed in <a href="lecture22.htm#method3">lecture 22</a> we  can also use the naive and robust variance estimates to select a correlation model. The model whose robust variance estimates most closely resembles its naive variance estimates is the better correlation model. For this we can focus only on the variance estimates or we can use the entire variance-covariance matrix. The square roots of the variances  can be extracted from the summary table. To obtain a single summary statistic for this comparison we might sum the absolute value of the differences of the variances.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> sapply(list(geefit.ind, geefit.ex), function(x) sum(abs(summary(x)$coefficients[,2]^2 - summary(x)$coefficients[,4]^2)))</div>
<span class="style24">[1] 6.20 3.19</span>
<p>Perhaps a better single summary statistic for this comparison is to use the entire parameter covariance matrix rather than just the variances. I sum the absolute differences between the naive and robust covariance matrices.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">sapply(list(geefit.ind, geefit.ex), function(x) sum(abs(x$robust.variance - x$naive.variance)))</div>
<span class="style24">[1] 48.57 35.85</span>
<p>Both statistics select the exchangeable structure.</p>
<h2 name="nlme"><a name="Rgeepack" id="Rgeepack"></a>Generalized estimating equations using the geepack package</h2>
<p name="nlme">The <span class="style19">geepack</span> package can also be used to fit GEE models in R. It's primary advantage over the <span class="style19">gee</span> package is that it has a <span class="style22">waves</span> argument that can be used to identify the order of observations within groups making it  possible to fit temporal correlation models to data sets with missing values. The primary disadvantage of the <span class="style19">geepack</span> package is that it provides fewer  correlation structures, (currently only independence, exchangeable, unstructured, AR(1), and user-defined), although it is possible to define some additional structures as explained in Halekoh et al. (2006). The <span class="style19">geepack</span> package also provides a method for  the <span class="style1021">anova</span> function that can be used to carry out multivariate Wald tests.</p>
<p name="nlme"><a name="waves"></a> First we need to create a variable for the <span class="style22">waves</span> argument&mdash;an integer-valued variable that reflects the order of the observations in groups so that the proper observations in different groups get matched up correctly. For the current data  set we can accomplish this by pasting together the values of the variables <span class="style8">year</span> and <span class="style8">period</span>. The <span class="style1021">paste</span> function concatenates text strings together separated by the value specified in its <span class="style22">sep</span> argument. We then convert the created text to a factor and finally use <span class="style1021">as.numeric</span> to extract the numeric values of that factor, in this case the numbers 1 through 12.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> sm$wave &lt;- as.numeric(factor(paste(sm$year, sm$period, sep='.')))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> sm[25:46,]</div>
<span class="style24"> &nbsp;&nbsp; strtno year period rblval deply nesting2 size wave<br>
25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0.235&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp;&nbsp; 1<br>
26&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; 0.235&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp;&nbsp; 2<br>
27&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; 0.797&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp;&nbsp; 3<br>
28&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp; 1.909&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp;&nbsp; 4<br>
29&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0.383&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp;&nbsp; 5<br>
30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; 0.368&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp;&nbsp; 6<br>
31&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; 1.031&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp;&nbsp; 7<br>
32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp; 2.035&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;0 0.73&nbsp;&nbsp;&nbsp; 8<br>
33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0.281&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp;&nbsp; 9<br>
34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; 0.357&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp; 10<br>
35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; 1.130&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp; 11<br>
36&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp; 1.984&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.73&nbsp;&nbsp; 12<br>
37&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0.172&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.31&nbsp;&nbsp;&nbsp; 1<br>
38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; 0.173&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.31&nbsp;&nbsp;&nbsp; 2<br>
39&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; 0.851&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.31&nbsp;&nbsp;&nbsp; 3<br>
40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp; 1.960&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.31&nbsp;&nbsp;&nbsp; 4<br>
41&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0.318&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.31&nbsp;&nbsp;&nbsp; 5<br>
42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; 0.302&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.31&nbsp;&nbsp;&nbsp; 6<br>
43&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; 1.018&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.31&nbsp;&nbsp;&nbsp; 7<br>
44&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp; 2.065&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.31&nbsp;&nbsp;&nbsp; 8<br>
45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0.179&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.00&nbsp;&nbsp;&nbsp; 1<br>
46&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5 1997&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; 0.180&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 0.00&nbsp;&nbsp;&nbsp; 2</span>
<p name="nlme"><a name="geeglm"></a>We only need the <span class="style22">waves</span> argument for the unstructured and AR(1) correlations, but it doesn't hurt to include it in all the model calls. The function in the <span class="style19">geepack</span> package that fits GEE models is <span class="style1021">geeglm</span>. The syntax is  the same as for the <span class="style1021">gee</span> function except that AR(1) is specified as <span class="style1">corstr=&quot;ar1&quot;</span>. Fitting an <span class="style1">&quot;unstructured&quot;</span> correlation matrix can be very resource-intensive and for these data causes R to crash, so we skip it. The independence, exchangeable, and AR(1) correlation models are fit as follows.</p>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#independence</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">geeglmfit.ind &lt;- geeglm(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+ factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2), id=strtno, family=binomial(), corstr=&quot;independence&quot;, data=sm, scale.fix=T, waves=wave)</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#exchangeable</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">geeglmfit.ex &lt;- geeglm(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+ factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2), id=strtno, family=binomial(), corstr=&quot;exchangeable&quot;, data=sm, scale.fix=T, waves=wave)</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#AR(1)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">geeglmfit.ar1 &lt;- geeglm(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+ factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2), id=strtno, family=binomial(), corstr=&quot;ar1&quot;, data=sm, scale.fix=T, waves=wave)</div>
<p name="nlme">To compare these models we need to modify our QIC function so that it works with <span class="style1021">geeglm</span> output. The function  is shown below.</p>
<div class="style1" style="padding-left: 30px; text-indent:-30px">QIC.binom.geeglm &lt;- function(model.geeglm, model.independence)</div>
<div class="style1" style="padding-left: 30px; text-indent:-30px"> {</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px"> #calculates binomial QAIC of Pan (2001)</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px"> #obtain trace term of QAIC</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> AIinverse &lt;- solve(model.independence$geese$vbeta.naiv)</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> V.msR &lt;- model.geeglm$geese$vbeta</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> trace.term &lt;- sum(diag(AIinverse%*%V.msR))</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px">#estimated mean and observed values</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> mu.R &lt;- model.geeglm$fitted.values</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> y &lt;- model.geeglm$y</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px"> #scale for binary data</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> scale &lt;- 1</div>
<div class="style17" style="padding-left: 60px; text-indent:-30px"> #quasilikelihood for binomial model</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> quasi.R &lt;- sum(y*log(mu.R/(1-mu.R))+log(1-mu.R))/scale</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px">QIC &lt;- (-2)*quasi.R + 2*trace.term</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> output &lt;- c(QIC,trace.term)</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> names(output) &lt;- c('QIC','CIC')</div>
<div class="style1" style="padding-left: 60px; text-indent:-30px"> output</div>
<div class="style1" style="padding-left: 30px; text-indent:-30px">}</div>
<p name="nlme">This function is also available from the <a href="../../notes/QICbinomgeeglm.txt">class web site</a>. Applying the function to the three models we have fit yields the following.</p>

<div class="style10" style="padding-left: 30px; text-indent:-30px">sapply(list(geeglmfit.ind, geeglmfit.ex, geeglmfit.ar1), function(x) QIC.binom.geeglm(x,geeglmfit.ind))</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [,1]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [,2]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [,3]<br>
QIC 830.99921 829.11723 830.99933<br>
CIC&nbsp; 23.13358&nbsp; 21.24456&nbsp; 23.13364</span>
<p name="nlme">The exchangeable model ranks best using either CIC or QIC. The summary table of this model is shown below.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> summary(geeglmfit.ex)</div>
<span class="style24">Call:<br>
geeglm(formula = nesting2 ~ factor(year) + factor(period) + factor(deply) + <br>
&nbsp;&nbsp;&nbsp; rblval + factor(year) * factor(period) + rblval * factor(period) + <br>
&nbsp;&nbsp;&nbsp; size + I(size^2), family = binomial(), data = sm, id = strtno, <br>
&nbsp;&nbsp;&nbsp; waves = wave, corstr = &quot;exchangeable&quot;, scale.fix = T)</span>
<p><span class="style24">&nbsp;Coefficients:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate&nbsp; Std.err&nbsp; Wald Pr(&gt;|W|)&nbsp;&nbsp;&nbsp; <br>
  (Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -3.63025&nbsp; 0.63152 33.05&nbsp;&nbsp;&nbsp; 9e-09 ***<br>
  factor(year)1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.01778&nbsp; 0.36533&nbsp; 7.76&nbsp;&nbsp; 0.0053 ** <br>
  factor(year)1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;0.95134&nbsp; 0.30565&nbsp; 9.69&nbsp;&nbsp; 0.0019 ** <br>
  factor(period)2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.28438&nbsp; 0.70682&nbsp; 3.30&nbsp;&nbsp; 0.0692 .&nbsp; <br>
  factor(period)3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.43981&nbsp; 1.79132&nbsp; 1.86&nbsp;&nbsp; 0.1732&nbsp;&nbsp;&nbsp; <br>
  factor(period)4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.84071&nbsp; 2.52702&nbsp; 3.67&nbsp;&nbsp; 0.0554 .&nbsp; <br>
  factor(deply)2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.01573&nbsp; 0.29467&nbsp; 0.00&nbsp;&nbsp; 0.9574&nbsp;&nbsp;&nbsp; <br>
  rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.90822&nbsp; 1.66698&nbsp; 5.50&nbsp;&nbsp; 0.0191 *&nbsp; <br>
  size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.22636&nbsp; 0.05514 16.85&nbsp;&nbsp;&nbsp; 4e-05 ***<br>
  I(size^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.00715&nbsp; 0.00222 10.34&nbsp;&nbsp; 0.0013 ** <br>
  factor(year)1998:factor(period)2 -1.84861&nbsp; 0.57064 10.49&nbsp;&nbsp; 0.0012 ** <br>
  factor(year)1999:factor(period)2 -1.20950&nbsp; 0.45579&nbsp; 7.04&nbsp;&nbsp; 0.0080 ** <br>
  factor(year)1998:factor(period)3 -1.47907&nbsp; 0.82720&nbsp; 3.20&nbsp;&nbsp; 0.0738 .&nbsp; <br>
  factor(year)1999:factor(period)3 -1.12472&nbsp; 0.79685&nbsp; 1.99&nbsp;&nbsp; 0.1581&nbsp;&nbsp;&nbsp; <br>
  factor(year)1998:factor(period)4 -1.61419&nbsp; 0.69213&nbsp; 5.44&nbsp;&nbsp; 0.0197 *&nbsp; <br>
  factor(year)1999:factor(period)4 -1.25735&nbsp; 0.63192&nbsp; 3.96&nbsp;&nbsp; 0.0466 *&nbsp; <br>
  factor(period)2:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.40517&nbsp; 2.22897&nbsp; 1.16&nbsp;&nbsp; 0.2806&nbsp;&nbsp;&nbsp; <br>
  factor(period)3:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -5.11459&nbsp; 2.50854&nbsp; 4.16&nbsp;&nbsp; 0.0415 *&nbsp; <br>
  factor(period)4:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -6.02830&nbsp; 2.04198&nbsp; 8.72&nbsp;&nbsp; 0.0032 ** <br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1 </span>
<p><span class="style24">Scale is fixed.</span>
<p><span class="style24">Correlation: Structure = exchangeable&nbsp; Link = identity </span>
<p><span class="style24">Estimated Correlation Parameters:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Estimate Std.err<br>
  alpha&nbsp;&nbsp;&nbsp; 0.124&nbsp; 0.0223<br>
  Number of clusters:&nbsp;&nbsp; 109&nbsp;&nbsp; Maximum cluster size: 12</span>
<p name="nlme">The display differs somewhat from  what is produced by <span class="style1021">gee</span>. Only one column of standard errors is shown. These correspond to the robust estimates of <span class="style1021">gee</span>. The naive estimates are not shown. The robust or Huber sandwich estimator provides reasonable variance estimates even when the specified correlation model is incorrect. If the correlation model is nearly correct, so will be the naive standard errors, and robustification is unlikely to help much. So, unless you have strong reason to believe that the chosen correlation matrix is correct, it is recommended to always report the robust standard errors. </p>
<p name="nlme">The column labeled <span class="style24">Wald</span> in the summary table is the square of the <em>z</em>-statistic reported by the <span class="style1021">gee</span> function. Both the <em>z</em>-statistic and its square are variously referred to as Wald statistics. The square of a standard normal random variable is a chi-squared random variable with 1 degree of freedom, <img src="../../images/lectures/lecture23/chsq1.gif" alt="chisq1" width="52" height="32" align="absmiddle">.  So, the reported <em>p</em>-values are the upper tailed probabilities from a <img src="../../images/lectures/lecture23/chsq1.gif" alt="chisq1" width="52" height="32" align="absmiddle"> distribution and test whether the true parameter value is different from zero.</p>
<p name="nlme">The naive variance-covariance matrix of the parameter estimates can be found as the <span class="style22">vbeta.naiv</span> component of  the <span class="style361">geese</span> component of the model.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> sqrt(diag(geeglmfit.ex$geese$vbeta.naiv))</div>
<span class="style24"> &nbsp;[1] 0.56885 0.37051 0.38535 0.67443 1.82557 2.41482 0.26492 1.43756 0.05659 0.00227<br>
[11] 0.57878 0.54734 0.86741 0.86022 0.67778 0.63500 2.10162 2.47248 1.88963</span>
<p>Using these standard errors Wald statistics can then be constructed by hand. The squared versions of the Wald statistics using the naive standard errors are shown below. </p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">(coef(geeglmfit.ex)/sqrt(diag(geeglmfit.ex$geese$vbeta.naiv)))^2</div>
<span class="style24">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(year)1998 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40.72722&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.54582 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(year)1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)2 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6.09467&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.62678 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)4 <br>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.78614&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.01836 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(deply)2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rblval <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.00353&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7.39107 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I(size^2) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16.00150&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9.90717 <br>
factor(year)1998:factor(period)2 factor(year)1999:factor(period)2 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.20156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.88309 <br>
factor(year)1998:factor(period)3 factor(year)1999:factor(period)3 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.90761&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.70948 <br>
factor(year)1998:factor(period)4 factor(year)1999:factor(period)4 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5.67187&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3.92075 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)2:rblval &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factor(period)3:rblval <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.30973&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.27916 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)4:rblval <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10.17733</span>
<p>These can then be compared to the upper tail of a <img src="../../images/lectures/lecture23/chsq1.gif" alt="chisq1" width="52" height="32" align="absmiddle"> distribution to obtain <em>p</em>-values.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">round(pchisq((coef(geeglmfit.ex)/ sqrt(diag(geeglmfit.ex$geese$vbeta.naiv)))^2, 1, lower.tail=F), 4)</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(year)1998 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0060 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(year)1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)2 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0136&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0569 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)4 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.1814&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0450 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(deply)2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rblval <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.9527&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;0.0066 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I(size^2) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0016 <br>
factor(year)1998:factor(period)2 factor(year)1999:factor(period)2 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0014&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0271 <br>
factor(year)1998:factor(period)3 factor(year)1999:factor(period)3 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0882&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.1911 <br>
factor(year)1998:factor(period)4 factor(year)1999:factor(period)4 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0172&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0477 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)2:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)3:rblval <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.2524&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0386 <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; factor(period)4:rblval <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0014 </span>
<p>These are quite similar to the <em>p</em>-values reported using the robust standard errors.</p>
<p>As was discussed in <a href="lecture22.htm#method3">lecture 22</a> we  can also use the naive and robust variance estimates to select a correlation model. The model whose robust variance estimates most closely resembles its naive variance estimates is the better correlation model. To obtain a single summary statistic for this comparison I use the entire parameter covariance matrix and sum the absolute differences between the naive and robust covariance matrices.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">var.crit &lt;- function(mymodel) sum(abs(mymodel[[&quot;geese&quot;]]$vbeta.naiv-mymodel[[&quot;geese&quot;]]$vbeta))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> sapply(list(geeglmfit.ind, geeglmfit.ex, geeglmfit.ar1), var.crit)</div>
<span class="style24">[1] 49.1 36.4 49.1</span>
<p>The sum of the absolute differences between the naive and robust covariance estimates is smallest for the exchangeable correlation structure. This is consistent with the conclusions we drew using QIC and CIC.</p>
<p>To test whether a categorical predictor with more than two levels should be retained in a GEE model we need to test the entire set of dummy variables simultaneously as a single construct. The <span class="style19">geepack</span> package provides a method for the <span class="style1021">anova</span> function that carries out a multivariate Wald test. (Remember, there is no likelihood associated with GEE models and hence no likelihood ratio tests.) When the <span class="style1021">anova</span> function is applied to a single <span class="style1021">geeglm</span> object it returns sequential Wald tests for individual predictors with the tests carried out in the order the predictors were listed in the model formula.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> anova(geeglmfit.ex)</div>
<span class="style24">Analysis of 'Wald statistic' Table<br>
Model: binomial, link: logit<br>
Response: nesting2<br>
Terms added sequentially (first to last)</span>
<p><span class="style24">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Df&nbsp;&nbsp;&nbsp; X2 P(&gt;|Chi|)&nbsp;&nbsp;&nbsp; <br>
  factor(year)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp; 0.24&nbsp;&nbsp;&nbsp; 0.8872&nbsp;&nbsp;&nbsp; <br>
  factor(period)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 23.14&nbsp;&nbsp; 3.8e-05 ***<br>
  factor(deply)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0.02&nbsp;&nbsp;&nbsp; 0.8927&nbsp;&nbsp;&nbsp; <br>
  rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 1.01&nbsp;&nbsp;&nbsp; 0.3147&nbsp;&nbsp;&nbsp; <br>
  size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 7.57&nbsp;&nbsp;&nbsp; 0.0059 ** <br>
  I(size^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 9.43&nbsp;&nbsp;&nbsp; 0.0021 ** <br>
  factor(year):factor(period)&nbsp; 6 20.00&nbsp;&nbsp;&nbsp; 0.0028 ** <br>
  factor(period):rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp; 9.01&nbsp;&nbsp;&nbsp; 0.0291 *&nbsp; <br>
  ---<br>
  Signif. codes:&nbsp; 0 &lsquo;***&rsquo; 0.001 &lsquo;**&rsquo; 0.01 &lsquo;*&rsquo; 0.05 &lsquo;.&rsquo; 0.1 &lsquo; &rsquo; 1</span>
<h2 name="nlme"><a name="binary"></a>A binary mixed effects model</h2>
<p name="nlme">An alternative way to account for  repeated measures is to fit a mixed effects model with random intercepts. This yields what's called a conditional model instead of the marginal model that we obtain with GEE. The  parameters of  a conditional model  have a subject-specific interpretation rather than the population-average interpretation of a marginal model. Because logistic regression uses a nonlinear link function, the magnitudes of  the estimated effects in marginal models will differ from those same effects  estimated in conditional models. (See <a href="lecture21.htm#logit">lecture 21</a>.) In logistic regression the parameter estimates from a conditional  model tend to be larger in magnitude (more positive or more negative) than the corresponding parameter estimates from a marginal model.</p>
<p name="nlme"> The <span class="style19">lme4</span> package  fits generalized linear mixed effects models (GLMM) and can be used to fit a random intercepts model to binary data. A brief explanation of the syntax used in this package was given in <a href="lecture20.htm#fitting">lecture 20</a>.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">lmerfit &lt;- lmer(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+ factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2)+ (1|strtno), family=binomial, data=sm, REML=F)</div>
<p>For comparison I also fit an ordinary logistic regression model in which the repeated measures structure is ignored.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">glmfit &lt;- glm(nesting2~factor(year)+ factor(period)+ factor(deply)+ rblval+ factor(year)*factor(period)+ rblval*factor(period)+ size+ I(size^2), family=binomial, data=sm)</div>
<p>If we compare the AIC of the ordinary logistic regression model with that of the mixed effects logistic regression model we see that the AIC of the mixed effects model is lower indicating that it should be preferred. Thus we have evidence for observational heterogeneity, a conclusion that is consistent with the GEE model selection results that favored an exchangeable correlation structure over independence.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">AIC(glmfit,lmerfit)</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df AIC<br>
glmfit&nbsp; 19 823<br>
lmerfit 20 778</span>
<h2 name="nlme"><a name="comparing"></a>Comparing marginal and subject-specific models</h2>
<p name="nlme">Next I compare the parameter estimates from GLM, GEE, and GLMM.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> out.comp &lt;- round(cbind(coef(glmfit), coef(geeglmfit.ex), fixef(lmerfit)),3)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> rownames(out.comp) &lt;- names(coef(glmfit))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> colnames(out.comp) &lt;- c('GLM','GEE','GLMM')</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> out.comp</div>
<span class="style24"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GLM&nbsp;&nbsp;&nbsp; GEE&nbsp;&nbsp; GLMM<br>
(Intercept)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -3.777 -3.630 -4.834<br>
factor(year)1998&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.027&nbsp; 1.018&nbsp; 1.232<br>
factor(year)1999&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.955&nbsp; 0.951&nbsp; 1.174<br>
factor(period)2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.196&nbsp; 1.284&nbsp; 1.598<br>
factor(period)3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.200&nbsp; 2.440&nbsp; 3.227<br>
factor(period)4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.869&nbsp; 4.841&nbsp; 6.133<br>
factor(deply)2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.123 -0.016&nbsp; 0.108<br>
rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.214&nbsp; 3.908&nbsp; 5.036<br>
size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.224&nbsp; 0.226&nbsp; 0.311<br>
I(size^2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -0.007 -0.007 -0.010<br>
factor(year)1998:factor(period)2 -1.994 -1.849 -2.245<br>
factor(year)1999:factor(period)2 -1.318 -1.210 -1.457<br>
factor(year)1998:factor(period)3 -1.588 -1.479 -1.749<br>
factor(year)1999:factor(period)3 -1.237 -1.125 -1.305<br>
factor(year)1998:factor(period)4 -1.577 -1.614 -1.896<br>
factor(year)1999:factor(period)4 -1.270 -1.257 -1.507<br>
factor(period)2:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -2.288 -2.405 -2.987<br>
factor(period)3:rblval&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-5.280 -5.115 -6.676<br>
factor(period)4:rblval&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -6.331 -6.028 -7.703</span>
<p name="nlme">From the output we see that the subject-specific (conditional) mixed effects model coefficients  are  larger in magnitude than the same coefficients from the population-averaged (marginal) GEE model.  As was explained in <a href="lecture21.htm#subject">lecture 21</a>, the difference arises because averaging on a logit scale (conditional model) is not equivalent to averaging on the scale of the raw response (marginal model). </p>
<p name="nlme">For these data the variables <span class="style8">year</span>, <span class="style8">period</span>, and <span class="style8">rblval</span> have clear subject-specific interpretations because they vary across observation times. On the other hand the variables <span class="style8">size</span> and <span class="style8">deply</span> do not have clear subject-specific interpretations because they are constant at each nest site. With <span class="style8">size</span> this doesn't matter too much because <span class="style8">size</span> is  a control variable that is probably uninteresting on its own. On the other hand the variable <span class="style8">deply</span> (nest box type) is of some interest. For a subject-specific interpretation to make sense for <span class="style8">deply</span> we would need to be able to compare two individuals who are identical (have the same random effect) but occur in different nest box types. </p>
<p name="nlme">Fig. 1 compares the subject-specific and population-average interpretations for the predictor <span class="style8">rblval</span> during period 1 of 1999 for a single cylinder nest (<span class="style8">deply</span> = 0) in a wetland of <span class="style8">size</span> = 0. The individual subject-specific curves  that are displayed cover the complete range of random intercepts that were predicted. The pure fixed effects model corresponds to the center of this random effects distribution, u<sub>i</sub> = 0, and so represents the typical individual, i.e., the average individual on a logit scale. As the plot shows this is quite different from the marginal model, which represents the average individual on a probability scale.</p>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#population-averaged probability</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">logit.ex &lt;- function(x) {</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px"> lin.model &lt;- coef(geeglmfit.ex)[1]+ coef(geeglmfit.ex)[3]+ coef(geeglmfit.ex)[8]*x</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">exp(lin.model)/(1+exp(lin.model)) </div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">}</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#subject-specific probability</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">logit.ss &lt;- function(x,u=0) {</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px"> lin.model &lt;- fixef(lmerfit)[1]+ fixef(lmerfit)[3]+ fixef(lmerfit)[8]*x+ u</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">exp(lin.model)/(1+exp(lin.model)) </div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">}</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px">#draw curves</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">curve(logit.ex, from=.05, to=1.8, xlab='Rblval', ylab='Probability of use', ylim=c(0,1))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">sapply(unique(ranef(lmerfit))[[1]][,1], function(y) curve(logit.ss(x,y), add=T, col='grey70', lty=2)) -&gt; yuk</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">curve(logit.ss(x,0), add=T, col=1, lwd=2)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">curve(logit.ex, add=T, lwd=2, col=2)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">legend('bottomright', c('Population-average', expression(paste('Subject-specific, ', u[i]==0)), 'Subject-specific'), col=c(2,1,'grey40'), lwd=c(2,2,1), lty=c(1,1,2), cex=.8, bty='n')</div>
<p align="center" name="nlme"><img src="../../images/lectures/lecture23/fig1.png" width="460" height="300" alt="fig. 1"></p>
<p align="center" name="nlme"><span class="styleArial"><strong>Fig. 1 &nbsp;</strong>Comparing subject-specific and population-average models</span></p>
<h2><a name="checking"></a>Checking the correlations for feasibility</h2>
<p>As was discussed in <a href="lecture22.htm#problems">lecture 22</a>, the binomial distribution places constraints on the correlations that are possible. Because the mean and variance of binomial random variables are related, correlations between pairs of binomial random variables are related to their means, i.e., their joint probabilities. Prentice (1998) derived the following formula for the joint probability of the binary pair <em>y</em><em><sub>i</sub></em>&nbsp;and <em>y</em><em><sub>j</sub></em>.</p>
<p align="center"><img src="../../images/lectures/lecture23/prentice.gif" width="530" height="85" alt="prentice"></p>
<p>This joint probability is non-negative when</p>
<p align="center"><img src="../../images/lectures/lecture23/constraint.gif" width="250" height="75" alt="constraint"></p>
<p>Solving the inequality for <em>r<sub>ij</sub> </em>yields the following bounds on the correlation depending on the possible values of the binary observations.</p>
<blockquote>
  <p>lower bound: &nbsp;<img src="../../images/lectures/lecture23/lowerbound.gif" alt="lower bound" width="225" height="77" align="absmiddle">&nbsp;if <em>y<sub>i</sub></em> = 1 and <em>y<sub>j</sub></em> = 0 or <em>y<sub>i</sub></em> = 0 and <em>y<sub>j</sub></em> = 1 </p>
<p>  upper bound: &nbsp;<img src="../../images/lectures/lecture23/upperbound.gif" alt="upper bound" width="225" height="77" align="absmiddle">&nbsp;if <em>y<sub>i</sub></em> = 1 and <em>y<sub>j</sub></em> = 1 or <em>y<sub>i</sub></em> = 0 and <em>y<sub>j</sub></em> = 0
  </p>

</blockquote>
<p>The following function calculates the set of lower bounds and upper bounds for a given entry in the working correlation matrix. It examines the predicted probabilities and observed binary values for all observations that contribute to that correlation matrix entry and returns the value of the bound that they provide. The function has five arguments.</p>
<ol>
  <li>A vector of predicted probabilities, the fitted values.</li>
  <li>A vector of observed binary values.</li>
  <li>A vector of values of the wave variable.</li>
  <li>The value of the wave variable for the first observation, <em>y<sub>i</sub></em>.</li>
  <li>The value of the wave variable for the second observation, <em>y<sub>j</sub></em>.</li>
</ol>
<p>The two values of the wave variable  determine the location of the entry in  the correlation matrix.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">prentice &lt;- function(fitvals, y, wave.var, wave1, wave2) </div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">{</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">ui &lt;- fitvals</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">yvar &lt;- y</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">yi4 &lt;- yvar[wave.var==wave1]</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">yi7 &lt;- yvar[wave.var==wave2]</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">ui4 &lt;- ui[wave.var==wave1]</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">ui7 &lt;- ui[wave.var==wave2]</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">limits &lt;- -sqrt(ui4*ui7*(1-ui4)*(1-ui7))/((yi4-ui4)*(yi7-ui7)) </div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">one.zero &lt;- (1:length(yi4))[(yi4==0 &amp; yi7==1) | (yi4==1 &amp; yi7==0)]</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">both.zero &lt;- (1:length(yi4))[(yi4==0 &amp; yi7==0) | (yi4==1 &amp; yi7==1)]</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">upperbound &lt;- sort(limits[one.zero])</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">lowerbound &lt;- sort(limits[both.zero],decreasing=T)</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">out &lt;- list(lowerbound,upperbound)</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">names(out) &lt;- c(&quot;lowerbound&quot;,&quot;upperbound&quot;)</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">out</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">}</div>
<p>To use this function we  call it from a second function that then calculates the maximum lower bound and minimum upper bound on the correlation for a given correlation matrix entry.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">lims.func &lt;- function(fitvals, y, wave.var, wave1, wave2) {</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">out.fease &lt;- prentice(fitvals, y, wave.var, wave1, wave2) </div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">c(max(out.fease$lowerbound), min(out.fease$upperbound))</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">}</div>
<p>To use this function efficiently we need to construct a matrix whose rows contain all the possible pairs of values of the wave variable. For the current data set where the wave variable takes values 1 through 12, there are <img src="../../images/lectures/lecture23/combinatorial.gif" alt="combinatorial" width="67" height="65" align="absmiddle"> = 66 pairs to consider. We can generate them all with a nested for loop.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">wave.mat &lt;- matrix(NA, nrow=66, ncol=2)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">  k &lt;- 1</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">for(i in 1:11){</div>
<div class="style10" style="padding-left: 60px; text-indent:-30px">for(j in (i+1):12){</div>
<div class="style10" style="padding-left: 90px; text-indent:-30px">wave.mat[k,] &lt;- c(i,j)</div>
<div class="style10" style="padding-left: 90px; text-indent:-30px">k &lt;- k+1</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">}}</div>
<p>The first 15 rows are shown below.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> wave.mat[1:15,]</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [,1] [,2]<br>
  &nbsp;[1,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 2<br>
  &nbsp;[2,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 3<br>
  &nbsp;[3,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 4<br>
  &nbsp;[4,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 5<br>
  &nbsp;[5,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 6<br>
  &nbsp;[6,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 7<br>
  &nbsp;[7,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 8<br>
  &nbsp;[8,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 9<br>
  &nbsp;[9,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 10<br>
  [10,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 11<br>
  [11,]&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 12<br>
  [12,]&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp; 3<br>
  [13,]&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp; 4<br>
  [14,]&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp; 5<br>
[15,]&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp; 6</span>
<p>In the current data set the groups are unbalanced and the response variable has occasional missing values. Thus the returned fitted values and original response variable are of different lengths. To use them in the functions we first need to flesh out the data so that each group has 12 waves with missing values inserted for the waves that are not present.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">grps &lt;- unique(sm$strtno)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">  numgrps &lt;- length(grps)</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px">  #complete wave set for each group</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">  fulldata &lt;- data.frame(strtno=rep(grps, rep(12,numgrps )), wave=rep(1:12,numgrps))</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px">  #data frame of non-missing data</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">  actualdata &lt;- data.frame(strtno=sm$strtno[!is.na(sm$nesting2)], wave=sm$wave[!is.na(sm$nesting2)], pred=fitted(geefit.ex)[!is.na(sm$nesting2)], nesting2=sm$nesting2[!is.na(sm$nesting2)])</div>
<div class="style15" style="padding-left: 30px; text-indent:-30px">  #insert missing data by merging the two data frames</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px">newdat2 &lt;- merge(actualdata,fulldata, all=T)</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> newdat2[1:14,]</div>
<span class="style24">  &nbsp;&nbsp; strtno wave&nbsp;&nbsp; pred nesting2<br>
  1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 1 0.1896&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
  2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 2 0.3304&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
  3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 3 0.2756&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
  4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 4 0.1403&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
  5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 5 0.5189&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
  6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 6 0.2151&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>
  7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 7 0.1366&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>
  8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 8 0.0672&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
  9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp; 9 0.4609&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>
  10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 10 0.3464&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
  11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 11 0.1607&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br>
  12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 12 0.1009&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
  13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp; 1 0.1828&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br>
14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp; 2 0.3186&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1</span>
<p>With these preliminaries we can use the observed and fitted values to calculate bounds for each entry in the correlation matrix. I use <span class="style1021">sapply</span> to move row by row through the matrix <span class="style8">wave.mat</span> extracting pairs of wave values that correspond to the different locations in the correlation matrix.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px">bounds &lt;- sapply(1:66,function(x) lims.func(newdat2$pred, newdat2$nesting2, newdat2$wave, wave.mat[x,1], wave.mat[x,2]))</div>
<p>The first 8 lower and upper bounds are shown below.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> bounds[,1:8]</div>
<span class="style24">  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [,1]&nbsp;&nbsp; [,2]&nbsp;&nbsp; [,3]&nbsp;&nbsp;&nbsp; [,4]&nbsp;&nbsp; [,5]&nbsp;&nbsp;&nbsp; [,6]&nbsp; [,7]&nbsp;&nbsp;&nbsp; [,8]<br>
  [1,] -0.0913 -2.000 -1.194 -0.0801 -0.183 -0.0822 -1.61 -0.0826<br>
[2,]&nbsp; 0.3394&nbsp; 0.345&nbsp; 0.349&nbsp; 0.4531&nbsp; 0.425&nbsp; 0.5510&nbsp; 0.33&nbsp; 0.2984</span>
<p>With an exchangeable correlation matrix all the correlations are the same so we just need to be sure that this value lies within all 66 of the different lower and upper bounds we calculated. For more general correlation matrices we would need to match these bounds with the corresponding correlation matrix entries. The listed bounds correspond to the upper triangle of the correlation matrix listed by row or equivalently, the lower triangle of the correlation matrix listed by column. The following extracts the  correlation matrix entries in the same order specified by the bounds.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> correlations &lt;- geefit.ex$working.correlation[ lower.tri(geefit.ex$working.correlation)]</div>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> correlations</div>
<span class="style24">  &nbsp;[1] 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128<br>
  [14] 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128<br>
  [27] 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128<br>
  [40] 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128<br>
  [53] 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128 0.128<br>
[66] 0.128</span>
<p>Finally we can test that each estimated correlation lies within the calculated bounds.</p>
<div class="style10" style="padding-left: 30px; text-indent:-30px"> correlations &gt;= bounds[1,] &amp; correlations &lt;= bounds[2,]</div>
<span class="style24">  &nbsp;[1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE<br>
  [17] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE<br>
  [33] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE<br>
  [49] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE<br>
  [65] TRUE TRUE</span>

<p>So, the bounds are satisfied for all entries in the estimated exchangeable correlation matrix.</p>
<p>What should one do  if one or more of the bounds are not satisfied? Ziegler and Vens (2010) argue that the corresponding correlation model should be rejected in this case. I think this position is too extreme. Typically the violation is minor in that  only a small fraction of the joint probabilities are negative and often just barely so. In this case an argument could be made for just ignoring the problem. Probably a more honest solution is adjust the corresponding entry in the correlation matrix by moving it toward zero enough so that it now lies just inside the required bounds. This is an especially attractive option for unstructured correlation matrices where only a few entries are likely to be affected, less so for matrices that depend on a single parameter where changing one entry requires changing them all.</p>
<p><a name="zcor"></a>After making  changes to the correlation matrix the  GEE model can then be re-estimated treating the correlation matrix as fixed rather than a function of parameters that need to be estimated. In the <span class="style19">geepack</span> package this is accomplished by specifying <span class="style22">corstr=&quot;fixed&quot;</span>. The values in the lower triangle of the correlation matrix are entered into a vector where they are repeated as many times as there are groups in the data. This vector is then entered as the <span class="style22">zcor</span> argument of <span class="style1021">geeglm</span>. An example appears in the  help window for the <span class="style1021">geese</span> function for the case of balanced data in which each group has the same number of observations. If the different groups have different numbers of observations then constructing the <span class="style22">zcor</span> object is  more complicated. Furthermore, if the data set is even moderately large it's quite easy for <span class="style1021">geeglm</span> to crash R, which it does with the current data set.</p>
<h2><a name="cited"></a>Cited References</h2>
<ul>
  <li>Fieberg, John, Randall H. Rieger, Michael C. Zicus, and Jonathan S. Schildcrout. 2009. Regression modelling of correlated data in ecology: subject-specific and population averaged response patterns. <em>Journal of Applied Ecology</em> <strong>46</strong>(5): 1018&ndash;1025.</li>
  <li>Halekoh, Ulrich, S&oslash;ren H&oslash;jsgaard, and Jun Yan. 2006. The R package geepack for generalized estimating equations. <em>Journal of Statistical Software</em> <strong>15</strong>(2).</li>
  <li>Prentice R. L. 1988. Correlated binary regression with covariates specific to each binary observation. <em>Biometrics </em><strong>44</strong>: 1033&ndash;1048. </li>
  <li>Ziegler, A. and M. Vens. 2010. Generalized estimating equations: Notes on the choice of the working correlation matrix. <em>Methods of Information in Medicine</em> <strong>49</strong>: 421&ndash;425.</li>
</ul>
<p align="center"><a href="../../index.html">Course Home Page</a></p>
<hr align="center" width="75%">
<!--Standard footer follows -->
<table width="650" border="3" cellspacing="2" cellpadding="2" align=
"CENTER">
  <tr bgcolor="#CCCCCC">
    <td width="100%"><font size=-1>Jack Weiss<br>
      <i>Phone: </i>(919) 962-5930<br>
      <i>E-Mail:</i> jack_weiss@unc.edu<br>
      <i>Address: </i>Curriculum for the Environment and Ecology, Box 3275, University of North Carolina, Chapel Hill, 27599<br>
      Copyright &copy; 2012<br>
      Last Revised--March 5, 2012<br>
      URL: <a href="lecture23.htm#lecture23" target="_self">https://sakai.unc.edu/access/content/group/2842013b-58f5-4453-aa8d-3e01bacbfc3d/public/Ecol562_Spring2012/docs/lectures/lecture23.htm</a></font></td>
  </tr>
</table>
<p align="center">&nbsp;</p>
</body>
</html>
